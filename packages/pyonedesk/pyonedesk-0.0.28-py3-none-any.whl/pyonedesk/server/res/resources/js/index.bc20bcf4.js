(function(e){function t(t){for(var i,a,s=t[0],l=t[1],c=t[2],d=0,f=[];d<s.length;d++)a=s[d],o[a]&&f.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(f.length)f.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(i=!1)}i&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},o={index:0},r=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("df31")},"01bd":function(e,t,n){"use strict";var i=n("b954"),o=n.n(i);o.a},"0372":function(e,t,n){"use strict";var i=n("18e4"),o=n.n(i);o.a},"045a":function(e,t,n){"use strict";var i=n("7004"),o=n.n(i);o.a},"0997":function(e,t,n){},"18e4":function(e,t,n){},"2ec3":function(e,t,n){"use strict";var i=n("9e73"),o=n.n(i);o.a},"3ad6":function(e,t,n){},4230:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i="/admin/api",o={accountsList:i+"/accounts",createAccountID:i+"/account/create_id",addAccount:i+"/accounts/add",addAccountName:i+"/accounts/add",deleteAccount:i+"/accounts/delete",account:i+"/account",goCreateAppUrl:i+"/go_create_app",goGetCode:i+"/go_get_code",stylizes:i+"/stylizes",uploadFile:i+"/upload",createFolder:i+"/create_folder"}},"500d":function(e,t,n){"use strict";var i=n("e655"),o=n.n(i);o.a},5594:function(e,t,n){},"5e4f":function(e,t,n){"use strict";var i=n("792c"),o=n.n(i);o.a},"5e53":function(e,t,n){"use strict";var i=n("cfdb"),o=n.n(i);o.a},"62ea":function(e,t,n){},"66f8":function(e,t,n){},6845:function(e,t,n){},7004:function(e,t,n){},"792c":function(e,t,n){},8610:function(e,t,n){"use strict";var i=n("6845"),o=n.n(i);o.a},"8e41":function(e,t,n){"use strict";var i=n("66f8"),o=n.n(i);o.a},"9b68":function(e,t,n){},"9e73":function(e,t,n){},a440:function(e,t,n){"use strict";var i=n("62ea"),o=n.n(i);o.a},a7b8:function(e,t,n){"use strict";var i=n("3ad6"),o=n.n(i);o.a},b954:function(e,t,n){},bbbe:function(e,t,n){"use strict";var i=n("0997"),o=n.n(i);o.a},c4b9:function(e,t,n){"use strict";var i=n("d073"),o=n.n(i);o.a},cfdb:function(e,t,n){},d073:function(e,t,n){},ddbb:function(e,t,n){"use strict";var i=n("5594"),o=n.n(i);o.a},df31:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("a026"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desktop full",on:{dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}},[n("settings"),!1===e.loading&&0===e.users.length?n("empty-user-tips"):e._e(),e._l(e.users,function(e){return n("user-view",{key:e.id,attrs:{user:e}})}),e._l(e.windows,function(e){return n("window",{key:e.id,attrs:{window:e,uploads:e.uploads}})}),n("contextmenu",{attrs:{x:e.menu.x,y:e.menu.y,file:e.menu.file,id:e.menu.id},model:{value:e.menu.show,callback:function(t){e.$set(e.menu,"show",t)},expression:"menu.show"}})],2)},r=[],a=(n("7f7f"),n("96cf"),n("3b8d")),s="",l={accounts:s+"/accounts",loadFile:s+"/path"},c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"window",class:{active:e.$store.state.activeID===e.window.id,dragging:e.dragging,loading:e.loading},style:{"z-index":e.window.z},attrs:{tabindex:e.window.z},on:{focus:e.focus,blur:e.blur}},[n("div",{staticClass:"window--head"},[n("div",{staticClass:"name"},[e._v(" "+e._s(e.current.name))]),n("div",{staticClass:"controller",staticStyle:{"margin-right":"10px"}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.load(!0)}}},[n("use",{attrs:{"xlink:href":"#py_shuaxin"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex<=0},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go()}}},[n("use",{attrs:{"xlink:href":"#py_houtui"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex>=e.history.length-1},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go(1)}}},[n("use",{attrs:{"xlink:href":"#py_qianjin"}})])]),n("div",{staticClass:"controller"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:e.close}},[n("use",{attrs:{"xlink:href":"#py_guanbi"}})])])]),n("div",{staticClass:"window--path"},[n("el-breadcrumb",{staticClass:"path",attrs:{separator:"/"}},[n("el-breadcrumb-item"),e._l(e.path,function(t,i){return n("el-breadcrumb-item",{key:i},[n("a",{on:{click:function(t){e.go(-(e.path.length-i-1))}}},[e._v(e._s(t))])])})],2),n("window-folder-tool",{directives:[{name:"show",rawName:"v-show",value:!1===e.loading&&e.showFolder,expression:"loading === false && showFolder"}],attrs:{window:e.window,file:e.current},on:{upload:e.upload}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.dragging,expression:"!dragging"}],staticClass:"window--body",class:{loading:e.loading}},[e.loading?n("window-loading"):e._e(),e.error?n("window-error",{attrs:{error:e.error}}):e._e(),[e.showFolder?[n("window-folder",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{open:e.open,"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showEditor?[n("window-editor",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showViewer?[n("window-viewer",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showPlayer?[n("window-player",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:[n("window-binary-file",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]]],2)])},u=[],d=(n("7514"),n("a481"),n("d225")),f=n("b0b4"),h=(n("ac4d"),n("8a81"),n("0d6d"),n("2ef0")),p=Object.freeze({Normal:Symbol("normal"),Image:Symbol("image"),Audio:Symbol("audio"),Video:Symbol("video"),Text:Symbol("text"),Code:Symbol("code"),Word:Symbol("word"),Excel:Symbol("excel"),PPT:Symbol("ppt"),Zip:Symbol("zip"),Folder:Symbol("folder"),PDF:Symbol("pdf")}),m=Object.freeze({Normal:Symbol("normal"),Uploading:Symbol("uploading"),Waiting:Symbol("waiting"),Deleting:Symbol("deleting"),UploadFail:Symbol("uploadFail")}),v=Object.freeze({Name:Symbol("name"),Size:Symbol("size"),CreatedTime:Symbol("ctime"),ModifiedTime:Symbol("mtime")}),g=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],w=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],y=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],b=["application/zip","application/x-7z-compressed","application/x-rar-compressed","application/x-tar","application/x-bzip","application/x-bzip2"];function x(e,t){console.log("fileNameToType",e);for(var n=0;n<t.length;n++)if(-1!==e.lastIndexOf(t[n]))return!0;return!1}var _=[".py",".cs",".c",".htm",".js",".xml",".php",".jsp",".rb",".pl",".asp",".ini",".cg",".java",".as",".config",".hh",".hs",".css",".scss",".sass"],k=function(){function e(t,n,i){Object(d["a"])(this,e),this.name=t,this.mimeType=i,this.path=n.replace(/\/+/g,"/"),this.thumbnail=null,this.id=null}return Object(f["a"])(e,[{key:"setType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.type=e:this.mimeType?-1!==this.mimeType.indexOf("image/")?this.type=p.Image:-1!==this.mimeType.indexOf("audio/")?this.type=p.Audio:-1!==this.mimeType.indexOf("video/")?this.type=p.Video:x(this.name,_)?this.type=p.Code:-1!==g.indexOf(this.mimeType)?this.type=p.Word:-1!==w.indexOf(this.mimeType)?this.type=p.Excel:-1!==y.indexOf(this.mimeType)?this.type=p.PPT:-1!==b.indexOf(this.mimeType)?this.type=p.Zip:"text/plain"===this.mimeType?this.type=p.Text:"application/pdf"===this.mimeType?this.type=p.PDF:this.type=p.Normal:this.type=p.Folder,this}},{key:"setFromData",value:function(e){var t=Object(h["get"])(e,"thumbnails[0].small.url");return t&&(this.thumbnail=t),this.id=e.id,this.mimeType=Object(h["get"])(e,"file.mimeType"),e["parentReference"]&&e["parentReference"]["path"]&&(this.path="/drive/root:"===e["parentReference"]["path"]?"/":e["parentReference"]["path"].replace("/drive/root:","/")),this}},{key:"setState",value:function(e){return this.state=e,this}}]),e}(),C={type:v.Name,isUp:!1},F=(n("ac6a"),n("6b54"),Object.freeze({FileUploaded:Symbol("uploaded"),FileDeleted:Symbol("deleted"),SortFile:Symbol("sort"),SearchFile:Symbol("search")})),O=function(){function e(t,n,i){Object(d["a"])(this,e),this.id=Date.now().toString(32),this.user=t,this.file=n,this.z=i,this.events={}}return Object(f["a"])(e,[{key:"addEventListener",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}},{key:"clearEventListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events[e]=[]:this.events={}}}]),e}(),j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-editor-container"},[n("div",{staticClass:"text-editor"}),n("div",{staticClass:"saving",class:{show:e.saving}},[e._v("保存中")])])},E=[],U=(n("4917"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")}),S=[],T={name:"window-base-content",data:function(){return{loading:!1}},methods:{load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],!this.loading){e.next=3;break}return e.abrupt("return");case 3:if(this.$emit("update:loading",!0),this.loading=!0,!this.loadContent){e.next=8;break}return e.next=8,this.loadContent(t);case 8:this.loading=!1,this.$emit("update:loading",!1);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},I=T,D=n("2877"),z=Object(D["a"])(I,U,S,!1,null,"78bdcbee",null),W=z.exports,R=n("df7c"),N={extends:W,name:"window-editor",props:{window:O,file:k},data:function(){return{$cm:null,saving:!1}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,o,r,a,s,l,c,u,d=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],n=":"+Object(R["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{force:t,user:this.window.user,path:n});case 4:return i=e.sent,o=i.data,e.next=8,this.$http.get(o["@microsoft.graph.downloadUrl"]);case 8:r=e.sent,a=r.data,this.$cm.setValue(a.toString()),s=this.file.name.match(/.+\.([^.]+)$/),console.log("editor 1",s),s&&(u=CodeMirror.findModeByExtension(s[1]),u&&(l=u.mode,c=u.mime)),console.log("editor 2",l,c),l?(this.$cm.setOption("mode",c),CodeMirror.autoLoadMode(this.$cm,l)):this.$cm.setOption("mode","text/plain");case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),deleteCache:function(){this.$store.commit("deleteCache",{user:this.window.user,path:":"+this.file.path})},save:function(){var e=this;this.loading||this.saving||(this.saving=!0,this.$http({method:"post",url:"/admin/api/upload/"+this.window.user.id,params:{path:Object(R["join"])(this.file.path,this.file.name),type:"text"},data:this.$cm.getValue()}).then(function(){e.deleteCache()}).catch(function(t){e.$notify.error("".concat(e.file.name," 保存失败：").concat(t.response.data))}).finally(function(){e.saving=!1}))}},mounted:function(){CodeMirror.modeURL="https://cdn.bootcss.com/codemirror/5.48.0/mode/%N/%N.js",this.$cm=CodeMirror(this.$el.querySelector(".text-editor"),{lineNumbers:!0,extraKeys:{"Ctrl-S":this.save,"Cmd-S":this.save}})}},P=N,L=(n("0372"),Object(D["a"])(P,j,E,!1,null,null,null)),M=L.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-viewer"},[e.loading?e._e():n("img",{attrs:{src:e.src,alt:"图片"}})])},A=[],Q={extends:W,name:"window-viewer",props:{window:O,file:k},data:function(){return{src:""}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i,o,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=":"+this.file.path+"/"+this.file.name,e.next=3,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 3:return i=e.sent,o=i.data,this.src=o["@microsoft.graph.downloadUrl"],r=new Image,r.src=this.src,e.next=10,new Promise(function(e){r.addEventListener("load",function(){e()}),setTimeout(function(){e()},1e4)});case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},q=Q,J=(n("e2e6"),Object(D["a"])(q,V,A,!1,null,"965d23f6",null)),B=J.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"})},Y=[],Z={extends:W,name:"window-player",props:{window:O,file:k},data:function(){return{}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("player mounted"),n=":"+Object(R["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 4:i=e.sent,o=i.data,console.log("player",n,o),new DPlayer({container:this.$el,video:{url:o["@microsoft.graph.downloadUrl"]}});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},G=Z,H=(n("8610"),Object(D["a"])(G,X,Y,!1,null,"fa4addb2",null)),K=H.exports,ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"folder-container",on:{dragenter:function(t){return t.preventDefault(),e.dragEnter(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.dropFile(t)},paste:function(t){return t.preventDefault(),e.paste(t)}}},[e.isDragEnter?n("div",{ref:"dragLeave",staticClass:"upload-icon",on:{dragleave:function(t){return t.preventDefault(),e.dragLeave(t)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"data-v-093dcf52":"","xlink:href":"#py_shangchuan1"}})]),e._m(0)]):e._e(),n("div",{staticClass:"folder"},e._l(e.files,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t,id:e.window.id},on:{dblclick:e.open}})}),1),e.nextPage?n("div",{staticClass:"next-page"},[n("el-button",{attrs:{type:"text",loading:e.loading},on:{click:e.loadNextPage}},[e._v("加载更多")])],1):e._e(),e.uploading.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[n("span",[e._v("上传中，同时上传："+e._s(e.queueConcurrency))]),n("el-button",{attrs:{type:"text"},on:{click:function(t){e.$store.state.settings=!0}}},[e._v("设置")])],1),n("div",{staticClass:"folder"},e._l(e.uploading,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),e.uploadFails.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("上传失败\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearUploadFail}},[e._v("清空")])],1),n("div",{staticClass:"folder"},e._l(e.uploadFails,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),e.waiting.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("等候上传\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearWaiting}},[e._v("全部取消")])],1),n("div",{staticClass:"folder"},e._l(e.waiting,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),n("input",{ref:"fileInput",staticClass:"hidden-file-input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.selectUploadFiles}})])},te=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("\n            将文件 / 文件夹 上传到这个目录"),n("br")])}],ne=(n("55dd"),n("386d"),n("75fc")),ie=(n("28a5"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file",on:{dblclick:e.open,contextmenu:function(t){return t.preventDefault(),e.contextmenu(t)},click:e.click}},[n("div",{staticClass:"file-icon",class:{uploading:e.isUploading||e.isWaiting}},[e.image?[n("img",{attrs:{src:e.file.thumbnail,alt:"图片"}}),e.isVideo?n("svg",{staticClass:"icon video-play-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_play"}})]):e._e()]:n("file-icon",{attrs:{file:e.file}}),!1===e.isNormal?n("div",{staticClass:"state-icon-container"},[e.isUploading?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan"}})]),n("div",[e._v("上传中")])]):e.isWaiting?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_yuyue-lishi-shijian"}})]),n("div",[e._v("等待上传")])]):e._e()]):e._e()],2),n("div",{staticClass:"file-name"},[n("div",{staticClass:"file-name__ellipsis"},[e._v(e._s(e.file.name))]),n("div",{staticClass:"file-name__full"},[e._v(e._s(e.file.name))])])])}),oe=[],re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{staticClass:"icon file-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})])},ae=[],se={name:"file-icon",props:["file"],computed:{icon:function(){switch(this.file.type){case p.Folder:return Icons["folder"];case p.Audio:return Icons["audio"];case p.Video:return Icons["video"];case p.Image:return Icons["image"];case p.Text:return Icons["text"];case p.Zip:return Icons["zip"];case p.PDF:return Icons["pdf"];case p.Word:return Icons["word"];case p.Excel:return Icons["excel"];case p.PPT:return Icons["ppt"];case p.Code:return Icons["code"];default:return Icons["default"]}}}},le=se,ce=Object(D["a"])(le,re,ae,!1,null,"3705e7de",null),ue=ce.exports,de={components:{FileIcon:ue},props:{id:String,parent:k,file:k},data:function(){return{image:null}},computed:{isNormal:function(){return this.file.state===m.Normal},isUploading:function(){return this.file.state===m.Uploading},isWaiting:function(){return this.file.state===m.Waiting},isUploadFail:function(){return this.file.state===m.UploadFail},isVideo:function(){return this.file.type===p.Video}},methods:{open:function(){console.log("open",this.file),this.file.state===m.Normal&&this.$emit("dblclick",this.file)},contextmenu:function(e){(this.isWaiting||this.isUploading)&&this.$store.commit("appendMenuItem",{name:"取消上传",click:this.click}),this.$store.commit("contextmenu",{e:e,id:this.id,file:this.file})},click:function(){var e=this;if(!this.isNormal&&!this.isUploading)if(console.log("file click",{isWaiting:this.isWaiting,isUploadFail:this.isUploadFail}),this.isWaiting)this.$confirm("取消上传 ".concat(this.file.name," ？")).then(function(){e.$store.commit("cancelUploadFile",e.file)}).catch(function(){});else if(this.isUploadFail){var t=this.file.reason||"";this.$confirm("上传失败原因：".concat(t),"再次尝试上传 ".concat(this.file.name," ？")).then(function(){var t=e.$store.getters.getUploadingDataByFile(e.file);t&&e.$store.commit("uploadQueuePush",t)}).catch(function(){})}},loadThumbnail:function(){var e=this;if(this.image=null,this.file.state===m.Normal&&[p.Image,p.Video].indexOf(this.file.type)>-1&&this.file.thumbnail){var t=new Image;t.src=this.file.thumbnail,t.addEventListener("load",function(){e.image=e.file.thumbnail})}}},watch:{file:function(){this.loadThumbnail()}},mounted:function(){this.loadThumbnail()}},fe=de,he=(n("2ec3"),Object(D["a"])(fe,ie,oe,!1,null,"1b47ecf5",null)),pe=he.exports,me=n("431d"),ve=n("4230"),ge=n("df7c"),we={extends:W,name:"window-folder",components:{FileView:pe},props:{window:O,file:k},data:function(){return{isDragEnter:!1,files:[],nextPage:null,search:"",sort:JSON.parse(JSON.stringify(C))}},watch:{file:function(){this.nextPage=null,this.files.length=0,this.search="",this.sort=JSON.parse(JSON.stringify(C)),this.load()}},computed:{uploading:function(){return this.$store.getters.getUploading(this.window.user,this.file.path)},waiting:function(){return this.$store.getters.getUploading(this.window.user,this.file.path,m.Waiting)},uploadFails:function(){return this.$store.getters.getUploading(this.window.user,this.file.path,m.UploadFail)},queueConcurrency:{get:function(){return this.$store.getters.getUploadQueueConcurrency},set:function(e){console.log("改变队列数量",e),this.$store.commit("setUploadQueueConcurrency",e)}}},methods:{paste:function(e){console.log("粘贴事件",e);var t=e.clipboardData||e.originalEvent.clipboardData;t.items&&console.log("粘贴板有内容",t.items.length)},dragEnter:function(){this.isDragEnter||(this.isDragEnter=!0)},dragLeave:function(e){e.target===this.$refs.dragLeave&&(this.isDragEnter=!1)},click_upload:function(e){var t=this.$refs.fileInput;"folder"===e?(t.setAttribute("webkitdirectory",""),t.setAttribute("directory","")):(t.removeAttribute("webkitdirectory"),t.removeAttribute("directory")),this.$refs.fileInput.click()},selectUploadFiles:function(e){for(var t=this,n=e.target.files,i=function(e){var i=n[e],o=ge.join(t.file.path,t.file.name,i.webkitRelativePath);console.log("input file",i);var r=new k(i.name,o,i.type);r.file=i;var a=Object(h["findIndex"])(t.files,{path:i.path,name:i.name});a>-1&&t.$confirm("".concat(i.name," 已经存在，是否覆盖？")).then(function(){t.$store.commit("uploadFile",{id:t.window.id,path:t.file.path,file:r})}).catch(function(){}),t.$store.commit("uploadFile",{id:t.window.id,path:t.file.path,file:r})},o=0;o<n.length;o++)i(o)},dropFile:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isDragEnter=!1,e.next=3,Object(me["getFilesFromDataTransferItems"])(t.dataTransfer.items);case 3:n=e.sent,n.forEach(function(e){var t=e.filepath.split("/");t.pop();var n=ge.join.apply(ge,[i.file.path,i.file.name].concat(Object(ne["a"])(t))),o=new k(e.name,n,e.type);o.file=e;var r=Object(h["findIndex"])(i.files,{path:o.path,name:o.name});r>-1?i.$confirm("".concat(o.name," 已经存在，是否覆盖？")).then(function(){i.$store.commit("uploadFile",{id:i.window.id,path:i.file.path,file:o})}).catch(function(){}):i.$store.commit("uploadFile",{id:i.window.id,path:i.file.path,file:o})});case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),open:function(e){console.log("window-folder open",e),this.$emit("open",e)},loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,o,r,a=this,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]&&s[0],n=ge.join(this.file.path,this.file.name),n="/"===n?"":":".concat(n,":"),this.search?n+="/search(q='".concat(this.search,"')?expand=thumbnails"):n+="/children?expand=thumbnails",i="name",e.t0=this.sort.type,e.next=e.t0===v.Name?8:e.t0===v.Size?10:e.t0===v.CreatedTime?12:e.t0===v.ModifiedTime?14:15;break;case 8:return i="name",e.abrupt("break",15);case 10:return i="size",e.abrupt("break",15);case 12:return i="createdDateTime",e.abrupt("break",15);case 14:i="lastModifiedDateTime";case 15:return n+="&orderby="+i+" "+(this.sort.isUp?"desc":"asc"),t&&(this.nextPage=null),e.prev=17,e.next=20,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 20:o=e.sent,r=o.data,this.files=r.value.map(function(e){var t=ge.join(a.file.path,a.file.name),n=new k(e.name,t).setFromData(e);return n.setFromData(e).setType().setState(m.Normal)}),r["@odata.nextLink"]?this.nextPage=r["@odata.nextLink"].split("/root")[1]:this.nextPage=null,e.next=30;break;case 26:e.prev=26,e.t1=e["catch"](17),console.log("folder loadContent",e.t1),this.$emit("loadError",e.t1.response.data);case 30:case"end":return e.stop()}},e,this,[[17,26]])}));function t(){return e.apply(this,arguments)}return t}(),loadNextPage:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$store.dispatch("load",{user:this.window.user,path:this.nextPage,force:!0});case 3:n=e.sent,i=n.data,(t=this.files).push.apply(t,Object(ne["a"])(i.value.map(function(e){var t=ge.join(o.file.path,o.file.name),n=new k(e.name,t);return n.setFromData(e).setType().setState(m.Normal)}))),i["@odata.nextLink"]?this.nextPage=i["@odata.nextLink"].split("/root")[1]:this.nextPage=null,this.loading=!1;case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),removeFile:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)},fileUploaded:function(e){if(e.path===ge.join(this.file.path,this.file.name)){var t=Object(h["findIndex"])(this.files,{name:e.name});t>-1&&this.files.splice(t,1),this.files.push(e)}},clearWaiting:function(){var e=this;this.$confirm("确认清空等待上传的任务？").then(function(){e.$store.commit("clearUploadingFile",m.Waiting)}).catch(function(){})},clearUploadFail:function(){var e=this;this.$confirm("确认清空上传失败的任务？").then(function(){e.$store.commit("clearUploadingFile",m.UploadFail)}).catch(function(){})},create:function(e,t){var n=this;if(console.log("创建",e,t),e===p.Folder){var i="/"===ge.join(this.file.path,this.file.name)?"/root":"/items/"+this.file.id;this.$http.get(ve["a"].createFolder+"/"+this.window.user.id+"?path="+i+"&name="+t).then(function(e){var i=e.data;n.files.push(new k(t,ge.join(n.file.path,t)).setFromData(i).setType(p.Folder).setState(m.Normal))}).catch(function(){})}else this.$alert("尚未实现")},sortFile:function(e){var t=e.type,n=e.isUp;console.log("排序",t,n),this.sort.type=t,this.sort.isUp=n,this.load()},searchFile:function(e){this.search=e,this.load()}},mounted:function(){this.window.addEventListener(F.FileUploaded,this.fileUploaded),this.window.addEventListener(F.FileDeleted,this.removeFile),this.window.addEventListener(F.SortFile,this.sortFile),this.window.addEventListener(F.SearchFile,this.searchFile)},beforeDestroy:function(){this.window.removeEventListener(F.FileUploaded,this.fileUploaded),this.window.removeEventListener(F.FileDeleted,this.removeFile),this.window.removeEventListener(F.SortFile,this.sortFile),this.window.removeEventListener(F.SearchFile,this.searchFile)}},ye=we,be=(n("a440"),Object(D["a"])(ye,ee,te,!1,null,"87baa390",null)),xe=be.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading"},[e._v("\n    读取中\n")])},ke=[],Ce={name:"window-loading"},$e=Ce,Fe=(n("01bd"),Object(D["a"])($e,_e,ke,!1,null,"09339c0c",null)),Oe=Fe.exports,je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("错误："+e._s(e.error))])},Ee=[],Ue={name:"window-error",props:["error"]},Se=Ue,Te=Object(D["a"])(Se,je,Ee,!1,null,"b8e6a73c",null),Ie=Te.exports,De=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file-container"},[n("file-icon",{attrs:{file:e.file}}),n("el-form",{attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"文件名"}},[e._v(e._s(e.file.name))]),n("el-form-item",{attrs:{label:"大小"}},[e._v(e._s(e.info.size))]),n("el-form-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.info.createdTime))]),n("el-form-item",{attrs:{label:"修改时间"}},[e._v(e._s(e.info.modifiedTime))]),n("el-form-item",[n("a",{attrs:{href:e.info.url,target:"_blank"}},[n("el-button",{attrs:{type:"text"}},[e._v("下载")])],1)])],1)],1)},ze=[],We={name:"window-binary-file",components:{FileIcon:ue},extends:W,props:{window:O,file:k},data:function(){return{info:{size:0,createdTime:"",modifiedTime:"",url:""}}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,o,r=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],n=":"+Object(R["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{user:this.user,path:n,force:t});case 4:i=e.sent,o=i.data,console.log("文件",o),this.$emit("loadFinish"),this.info.size=o.size,this.info.url=o["@microsoft.graph.downloadUrl"],this.info.createdTime=moment(new Date(o["createdDateTime"])).format("llll"),this.info.modifiedTime=moment(new Date(o["lastModifiedDateTime"])).format("llll");case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},Re=We,Ne=(n("c4b9"),Object(D["a"])(Re,De,ze,!1,null,"5a296d1c",null)),Pe=Ne.exports,Le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tool-container"},[n("div",[n("el-popover",{attrs:{placement:"bottom",width:"160"},model:{value:e.search.visible,callback:function(t){e.$set(e.search,"visible",t)},expression:"search.visible"}},[n("p",[n("el-input",{attrs:{placeholder:"输入要搜索的内容"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchFile(t)}},model:{value:e.search.word,callback:function(t){e.$set(e.search,"word",t)},expression:"search.word"}})],1),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.searchFile}},[e._v("搜索")])],1),n("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("搜索")])],1)],1),n("el-dropdown",{attrs:{size:"mini",trigger:"click"},on:{command:e.sortFile}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                排序"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.sortItems,function(t,i){return n("el-dropdown-item",{key:i,class:{current:t.type===e.sort.type},attrs:{command:t.command,icon:e.sortIcon(t.type)}},[e._v("\n                "+e._s(t.name)+"\n            ")])}),1)],1),n("el-dropdown",{attrs:{size:"mini",trigger:"click"},on:{command:e.create}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                创建"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"folder"}},[e._v("文件夹")]),n("el-dropdown-item",{attrs:{divided:""}}),n("el-dropdown-item",{attrs:{command:"text"}},[e._v("文本文件")])],1)],1),n("el-dropdown",{attrs:{type:"text",size:"mini",trigger:"hover","split-button":""},on:{click:function(t){return e.upload("file")},command:e.upload}},[e._v("\n        上传\n        "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"file"}},[e._v("文件")]),n("el-dropdown-item",{attrs:{command:"folder"}},[e._v("文件夹")])],1)],1)],1)},Me=[],Ve={name:"window-folder-tool",props:{window:O,file:k},data:function(){return{sort:JSON.parse(JSON.stringify(C)),search:{visible:!1,word:""}}},watch:{file:function(){}},methods:{upload:function(e){this.$emit("upload",e)},create:function(e){var t=this;"folder"===e?this.$prompt("输入文件夹名称","创建文件夹").then(function(e){var n=e.value;t.$refs["content"].create(p.Folder,n)}).catch(function(){}):"text"===e&&this.$prompt("输入文本文件名称","创建文本文件").then(function(e){var n=e.value;t.$refs["content"].create(p.Text,n)}).catch(function(){})},sortFile:function(e){switch(e){case"name":this.sort.type===v.Name?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.Name;break;case"size":this.sort.type===v.Size?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.Size;break;case"cTime":this.sort.type===v.CreatedTime?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.CreatedTime;break;case"mTime":this.sort.type===v.ModifiedTime?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.ModifiedTime;break;default:break}this.window.trigger(F.SortFile,this.sort)},searchFile:function(){this.window.trigger(F.SearchFile,this.search.word)},sortIcon:function(e){return e!==this.sort.type?"":this.sort.isUp?"el-icon-top":"el-icon-bottom"}},computed:{sortItems:function(){return[{name:"名称",command:"name",type:v.Name}]}}},Ae=Ve,Qe=(n("5e53"),n("f514"),Object(D["a"])(Ae,Le,Me,!1,null,"87340786",null)),qe=Qe.exports,Je={components:{WindowFolderTool:qe,WindowBinaryFile:Pe,WindowError:Ie,WindowLoading:Oe,WindowFolder:xe,WindowPlayer:K,WindowViewer:B,WindowEditor:M},props:{window:O},data:function(){return{loading:!0,dragging:!1,zIndex:0,active:!0,history:[],historyIndex:0,error:null}},methods:{upload:function(e){!1===this.loading&&this.$refs["content"].click_upload&&this.$refs["content"].click_upload(e)},close:function(){this.$store.commit("closeWindow",this.window.id)},focus:function(){this.$store.state.activeID!==this.window.id&&this.$store.commit("windowSetTop",this.window.id)},blur:function(){},loadError:function(e){this.error=e,this.loading=!1},load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n=this,i=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]&&i[0],this.loading=!0,this.error=null,this.$nextTick(function(){n.$refs["content"].load(t)});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),open:function(e){console.log("window.vue open",this.loading,e),this.loading||(this.history.splice(this.historyIndex+1),this.append(e),this.historyIndex++,this.load())},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this.loading){var t=this.historyIndex+e;t>=0&&t<this.history.length&&(this.historyIndex+=e)}},append:function(e){this.history.push(e)}},computed:{current:function(){return this.history[this.historyIndex]},showFolder:function(){return this.current.type===p.Folder},showPlayer:function(){return-1!==[p.Video,p.Audio].indexOf(this.current.type)},showEditor:function(){return-1!==[p.Code,p.Text].indexOf(this.current.type)},showViewer:function(){return-1!==[p.Image].indexOf(this.current.type)},path:function(){var e=this;return this.history.slice(0,this.historyIndex+1).map(function(t,n){return 0===n?e.window.user.name:t.name})}},beforeMount:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.append(this.window.file),e.next=3,this.load();case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),watch:{},mounted:function(){var e=this,t=$(this.$el),n=t.find(".window--head");t.mousedown(function(){e.focus()}).draggable({handle:n,cancel:".controller",start:function(){e.focus(),e.dragging=!0},stop:function(){e.dragging=!1}}).resizable({minHeight:200,minWidth:400,start:function(){e.dragging=!0},stop:function(){e.dragging=!1}})}},Be=Je,Xe=(n("5e4f"),n("8e41"),Object(D["a"])(Be,c,u,!1,null,"2da350fc",null)),Ye=Xe.exports,Ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user",on:{dblclick:e.open}},[n("div",{staticClass:"user-icon"},[n("svg",{staticClass:"icon main-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),e.user.lock?n("svg",{staticClass:"icon lock-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_lock"}})]):e._e()]),n("div",{staticClass:"user-name"},[e._v(e._s(e.user.name))])])},Ge=[],He=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d["a"])(this,e),this.id=t,this.name=n,this.lock=i},Ke={props:{user:He},data:function(){return{icon:Icons["user"]}},methods:{open:function(){this.$store.commit("createWindow",{user:this.user,file:new k("/","/").setType(),active:!0})}}},et=Ke,tt=(n("045a"),Object(D["a"])(et,Ze,Ge,!1,null,"6f342a14",null)),nt=tt.exports,it=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("div",{staticClass:"contextmenu full",style:{"z-index":e.$store.state.z},on:{click:e.hide,contextmenu:function(t){return t.preventDefault(),e.hide(t)}}},[n("div",{staticClass:"contextmenu-list",style:{left:e.offsetX,top:e.offsetY}},e._l(e.list,function(t,i){return n("div",{key:i,on:{click:t.click}},[e._v(e._s(t.name))])}),0)]):e._e()},ot=[],rt={name:"contextmenu",props:["value","x","y","id","file"],data:function(){return{list:[]}},methods:{hide:function(){this.$emit("input",!1),this.$store.state.menuExtraItems.length=0}},computed:{offsetX:function(){return this.x+2+"px"},offsetY:function(){return this.y+2+"px"}},watch:{file:function(){var e,t=this,n=this.$store.state.windows[this.id],i=n.user;this.list.length=0,this.file.state===m.Normal&&([p.Folder,p.Text,p.Code,p.Image,p.Video,p.Audio].indexOf(this.file.type)>-1&&this.list.push({name:"新窗口打开",click:function(){t.$store.commit("createWindowFromMenu",{file:t.file})}}),this.file.type!==p.Folder&&this.list.push({name:"下载文件",click:function(){window.open("/download/".concat(i.id,"?path=:").concat(Object(R["join"])(t.file.path,t.file.name)))}}),this.list.push({name:"删除文件",click:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$confirm("确认删除文件 ".concat(t.file.name," ?")).then(function(){t.$http({method:"delete",url:"/admin/api/".concat(i.id,"?path=").concat(Object(R["join"])(t.file.path,t.file.name))}).then(function(){t.$notify.success("成功删除 ".concat(t.file.name)),n.trigger(F.FileDeleted,t.file)}).catch(function(e){t.$notify.error("".concat(t.file.name," 删除失败：").concat(e.response.data))})}).catch(function(){});case 1:case"end":return e.stop()}},e)}));function o(){return e.apply(this,arguments)}return o}()})),(e=this.list).push.apply(e,Object(ne["a"])(this.$store.state.menuExtraItems))}}},at=rt,st=(n("500d"),Object(D["a"])(at,it,ot,!1,null,"7f9a61f3",null)),lt=st.exports,ct=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"settings-container",class:{show:e.show},on:{click:function(t){return t.target!==t.currentTarget?null:e.save(t)}}},[e.show?e._e():n("a",{staticClass:"settings-icon",attrs:{title:"打开设置界面"},on:{click:function(t){e.show=!e.show}}},[n("i",{staticClass:"el-icon-s-tools"})]),e.show?n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("全局设置")]),n("el-form",[n("el-form-item",{attrs:{label:"同时上传文件的数量"}},[n("el-input-number",{model:{value:e.concurrency,callback:function(t){e.concurrency=t},expression:"concurrency"}})],1)],1)],1):e._e()],1)},ut=[],dt={name:"settings",data:function(){return{queueConcurrency:5}},computed:{show:{set:function(e){this.$store.state.settings=e},get:function(){return this.$store.state.settings}},concurrency:{set:function(e){e<1?e=1:e>11&&(e=10),this.queueConcurrency=e},get:function(){return this.queueConcurrency}}},methods:{save:function(){this.$store.commit("setUploadQueueConcurrency",this.queueConcurrency),this.show=!1}}},ft=dt,ht=(n("a7b8"),Object(D["a"])(ft,ct,ut,!1,null,"351761e7",null)),pt=ht.exports,mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"empty-user"},[n("el-card",[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("友情提示")]),e._v("\n        请到"),n("a",{attrs:{href:"/admin"}},[n("el-button",{attrs:{type:"text"}},[e._v("管理后台")])],1),e._v("绑定 OneDrive 账号后再使用\n    ")])],1)},vt=[],gt={name:"empty-user-tips"},wt=gt,yt=(n("bbbe"),Object(D["a"])(wt,mt,vt,!1,null,"3c0fec99",null)),bt=yt.exports,xt={components:{EmptyUserTips:bt,Settings:pt,Contextmenu:lt,UserView:nt,Window:Ye},data:function(){return{loading:!0,users:[]}},computed:{windows:function(){return this.$store.state.windows},menu:function(){return this.$store.state.menu}},methods:{},beforeMount:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,o,r,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.$store.commit("setVueInstance",this),e.next=4,this.$store.dispatch("api",{url:l.accounts});case 4:for(i in t=e.sent,n=t.data,this.users.length=0,n)o=n[i],r=new He(o.id,o.name),this.users.push(r);this.loading=!1,window.addEventListener("beforeunload",function(e){if(a.$store.state.uploadingLength>0){var t="\\o/";return(e||window.event).returnValue=t,t}});case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},_t=xt,kt=(n("ddbb"),Object(D["a"])(_t,o,r,!1,null,"7099349e",null)),Ct=kt.exports,$t=n("2f62"),Ft=n("17d4"),Ot=n.n(Ft),jt=n("bc3a");i["default"].use($t["a"]);var Et,Ut=Ot()(function(e,t){var n=e.user,i=e.file;i.state=e.state=m.Uploading;var o=new FormData,r=Object(R["join"])(ve["a"].uploadFile,n.id)+"?type=file&path="+Object(R["join"])(i.path,i.name);o.append("file",i.file),jt({method:"post",url:r,data:o,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){var n=e.data;console.log("SUCCESS!!"),i.setFromData(n),i.setType(),Et.$notify.success({title:"上传成功",message:i.name}),t&&t(!0)}).catch(function(e){var n=e.response;console.log("FAILURE!!",n),i.reason=n.data,Et.$notify.error({title:"上传失败："+i.name,message:i.reason}),t&&t(!1)})},5),St=new $t["a"].Store({state:{z:1,windows:{},menu:{show:!1,x:0,y:0,id:null,file:null},menuExtraItems:[],activeID:null,error:null,cache:{},uploading:[],uploadingLength:0,uploadQueueConcurrency:Ut.concurrency,settings:!1},getters:{getUploading:function(e){return function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Uploading;return e.uploading.filter(function(e){return e.user===t&&e.path===n&&e.state===i})}},getUploadingDataByFile:function(e){return function(t){var n=Object(h["findIndex"])(e.uploading,["file",t]);return n>-1?e.uploading[n]:null}},getUploadQueueConcurrency:function(e){return e.uploadQueueConcurrency}},mutations:{setVueInstance:function(e,t){Et=t},setUploadQueueConcurrency:function(e,t){e.uploadQueueConcurrency=t,Ut.concurrency=t,console.log("改变后",Ut.concurrency)},setError:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";e.error={title:n,content:t.data}},setCache:function(e,t){var n=t.url,i=t.res;e.cache[n]=i},createWindow:function(e,t){var n=t.user,o=t.file,r=t.active,a=void 0!==r&&r;console.log("createWindow");var s=new O(n,o,e.z);i["default"].set(e.windows,s.id,s),e.z++,a&&(e.activeID=s.id)},createWindowFromMenu:function(e,t){var n=t.file;this.commit("createWindow",{user:e.windows[e.menu.id].user,file:n,active:!0})},contextmenu:function(e,t){var n=t.e,i=t.id,o=t.file;console.log("右键",n,i,o),e.menu.show=!0,e.menu.x=n.clientX,e.menu.y=n.clientY,e.menu.file=o,e.menu.id=i},appendMenuItem:function(e,t){var n=t.name,i=t.click;e.menuExtraItems.push({name:n,click:i})},clearWindow:function(e){e.windows={}},closeWindow:function(e,t){e.windows[t].clearEventListener(),i["default"].delete(e.windows,t)},windowSetTop:function(e,t){e.activeID=t,e.windows[t].z=e.z;var n=Object(h["sortBy"])(e.windows,"z");n.forEach(function(e){var t=n.indexOf(e);e.z=t+1}),e.z=n.length+1},uploadFile:function(e,t){var n=t.id,i=t.path,o=t.file,r=e.windows[n].user,a={id:n,user:r,path:i,file:o,state:m.Waiting};this.commit("uploadQueuePush",a)},cancelUploadFile:function(e,t){var n=Object(h["findIndex"])(e.uploading,["file",t]);n>-1&&(e.uploading.splice(n,1),Ut.remove(function(e){var n=e.data;return n.file===t}))},uploadQueuePush:function(e,t){var n=t.id,i=t.file,o=e.uploading.indexOf(t);o>-1&&e.uploading.splice(o,1),e.uploading.push(t),i.state=t.state=m.Waiting,Ut.push(t,function(o){console.log("上传结果",i.path,o);var r=e.uploading.indexOf(t);r>-1&&e.uploading.splice(r,1),o?(i.state=m.Normal,e.windows[n].trigger(F.FileUploaded,i)):(i.state=t.state=m.UploadFail,e.uploading.push(t))})},clearUploadingFile:function(e,t){e.uploading=e.uploading.filter(function(e){var n=e.file;return n.state!==t}),Ut.kill()},deleteCache:function(e,t){var n=t.user,i=t.path,o=l.loadFile+"/"+n.id+"?path="+i;delete e.cache[o]}},actions:{api:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jt(n);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),t.commit("setError",e.t0.response),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,6]])}));function t(t,n){return e.apply(this,arguments)}return t}(),load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){var i,o,r,a,s,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.user,o=n.path,r=n.force,a=void 0!==r&&r,s=l.loadFile+"/"+i.id+"?path="+encodeURIComponent(o),console.log("load",s,a),!t.state.cache[s]||a){e.next=5;break}return e.abrupt("return",t.state.cache[s]);case 5:return e.next=7,jt.get(s);case 7:return c=e.sent,200===c.status&&t.commit("setCache",{url:s,res:c}),e.abrupt("return",c);case 10:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()}}),Tt=St,It=(n("e008"),n("5c96")),Dt=n.n(It);n("0fae");i["default"].config.productionTip=!1,i["default"].use(Dt.a),i["default"].prototype.$http=n("bc3a"),new i["default"]({store:Tt,render:function(e){return e(Ct)}}).$mount("#app")},e008:function(e,t,n){},e2e6:function(e,t,n){"use strict";var i=n("9b68"),o=n.n(i);o.a},e655:function(e,t,n){},f514:function(e,t,n){"use strict";var i=n("fcc8"),o=n.n(i);o.a},fcc8:function(e,t,n){}});