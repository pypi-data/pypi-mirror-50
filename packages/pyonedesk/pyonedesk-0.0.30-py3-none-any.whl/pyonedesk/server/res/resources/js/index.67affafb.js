(function(e){function t(t){for(var i,a,s=t[0],c=t[1],l=t[2],d=0,f=[];d<s.length;d++)a=s[d],r[a]&&f.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={index:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("df31")},"01bd":function(e,t,n){"use strict";var i=n("b954"),r=n.n(i);r.a},"0372":function(e,t,n){"use strict";var i=n("18e4"),r=n.n(i);r.a},"045a":function(e,t,n){"use strict";var i=n("7004"),r=n.n(i);r.a},"0997":function(e,t,n){},"18e4":function(e,t,n){},2090:function(e,t,n){},"309d":function(e,t,n){"use strict";var i=n("8d7a"),r=n.n(i);r.a},"3a5f":function(e,t,n){"use strict";var i=n("a978"),r=n.n(i);r.a},"3ad6":function(e,t,n){},4230:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i="/admin/api",r={accountsList:i+"/accounts",createAccountID:i+"/account/create_id",addAccount:i+"/accounts/add",addAccountName:i+"/accounts/add",deleteAccount:i+"/accounts/delete",account:i+"/account",goCreateAppUrl:i+"/go_create_app",goGetCode:i+"/go_get_code",stylizes:i+"/stylizes",uploadFile:i+"/upload",createFolder:i+"/create_folder"}},"4fc1":function(e,t,n){},"51c0":function(e,t,n){"use strict";var i=n("7acf"),r=n.n(i);r.a},"5e4f":function(e,t,n){"use strict";var i=n("792c"),r=n.n(i);r.a},"5e53":function(e,t,n){"use strict";var i=n("cfdb"),r=n.n(i);r.a},"64ce":function(e,t,n){"use strict";var i=n("e784"),r=n.n(i);r.a},6845:function(e,t,n){},7004:function(e,t,n){},"792c":function(e,t,n){},"7acf":function(e,t,n){},8610:function(e,t,n){"use strict";var i=n("6845"),r=n.n(i);r.a},"8d7a":function(e,t,n){},9337:function(e,t,n){},9944:function(e,t,n){"use strict";function i(e){if(0===e)return"0 B";var t=1024,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,i)).toPrecision(3)+" "+n[i]}n.d(t,"a",function(){return i})},"9b68":function(e,t,n){},a7b8:function(e,t,n){"use strict";var i=n("3ad6"),r=n.n(i);r.a},a978:function(e,t,n){},b954:function(e,t,n){},bb28:function(e,t,n){"use strict";var i=n("2090"),r=n.n(i);r.a},bbbe:function(e,t,n){"use strict";var i=n("0997"),r=n.n(i);r.a},c203:function(e,t,n){"use strict";var i=n("4fc1"),r=n.n(i);r.a},cfdb:function(e,t,n){},df31:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("a026"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desktop full",on:{dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}},[n("settings"),!1===e.loading&&0===e.users.length?n("empty-user-tips"):e._e(),e._l(e.users,function(e){return n("user-view",{key:e.id,attrs:{user:e}})}),e._l(e.windows,function(e){return n("window",{key:e.id,attrs:{window:e,uploads:e.uploads}})}),n("contextmenu",{attrs:{x:e.menu.x,y:e.menu.y,file:e.menu.file,id:e.menu.id},model:{value:e.menu.show,callback:function(t){e.$set(e.menu,"show",t)},expression:"menu.show"}})],2)},o=[],a=(n("7f7f"),n("96cf"),n("3b8d")),s="",c={accounts:s+"/accounts",loadFile:s+"/path"},l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"window",class:{active:e.$store.state.activeID===e.window.id,dragging:e.dragging,loading:e.loading},style:{"z-index":e.window.z},attrs:{tabindex:e.window.z},on:{focus:e.focus,blur:e.blur}},[n("div",{staticClass:"window--head"},[n("div",{staticClass:"name"},[e._v(" "+e._s(e.current.name))]),n("div",{staticClass:"controller",staticStyle:{"margin-right":"10px"}},[n("svg",{staticClass:"icon",class:{disabled:e.loading},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.load(!0)}}},[n("use",{attrs:{"xlink:href":"#py_shuaxin"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex<=0},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go()}}},[n("use",{attrs:{"xlink:href":"#py_houtui"}})]),n("svg",{staticClass:"icon",class:{disabled:e.loading||e.historyIndex>=e.history.length-1},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.go(1)}}},[n("use",{attrs:{"xlink:href":"#py_qianjin"}})])]),n("div",{staticClass:"controller"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:e.close}},[n("use",{attrs:{"xlink:href":"#py_guanbi"}})])])]),n("div",{staticClass:"window--path"},[n("el-breadcrumb",{staticClass:"path",attrs:{separator:"/"}},[n("el-breadcrumb-item"),e._l(e.path,function(t,i){return n("el-breadcrumb-item",{key:i},[n("a",{on:{click:function(t){e.go(-(e.path.length-i-1))}}},[e._v(e._s(t))])])})],2),n("window-folder-tool",{directives:[{name:"show",rawName:"v-show",value:!1===e.loading&&e.showFolder,expression:"loading === false && showFolder"}],attrs:{window:e.window,file:e.current},on:{upload:e.upload}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.dragging,expression:"!dragging"}],staticClass:"window--body",class:{loading:e.loading}},[e.loading?n("window-loading"):e._e(),e.error?n("window-error",{attrs:{error:e.error}}):e._e(),[e.showFolder?[n("window-folder",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{open:e.open,"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showEditor?[n("window-editor",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showViewer?[n("window-viewer",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:e.showPlayer?[n("window-player",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]:[n("window-binary-file",{ref:"content",attrs:{window:e.window,file:e.current,loading:e.loading},on:{"update:loading":function(t){e.loading=t},loadError:e.loadError}})]]],2)])},u=[],d=(n("7514"),n("386d"),n("a481"),n("d225")),f=n("b0b4"),h=(n("ac4d"),n("8a81"),n("0d6d"),n("2ef0")),p=Object.freeze({Normal:Symbol("normal"),Image:Symbol("image"),Audio:Symbol("audio"),Video:Symbol("video"),Text:Symbol("text"),Code:Symbol("code"),Word:Symbol("word"),Excel:Symbol("excel"),PPT:Symbol("ppt"),Zip:Symbol("zip"),Folder:Symbol("folder"),PDF:Symbol("pdf")}),m=Object.freeze({Normal:Symbol("normal"),Uploading:Symbol("uploading"),Waiting:Symbol("waiting"),Deleting:Symbol("deleting"),UploadFail:Symbol("uploadFail")}),v=Object.freeze({Name:Symbol("name"),Size:Symbol("size"),CreatedTime:Symbol("ctime"),ModifiedTime:Symbol("mtime")}),g=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],w=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],y=["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],b=["application/zip","application/x-7z-compressed","application/x-rar-compressed","application/x-tar","application/x-bzip","application/x-bzip2"];function x(e,t){console.log("fileNameToType",e);for(var n=0;n<t.length;n++)if(-1!==e.lastIndexOf(t[n]))return!0;return!1}var _=[".py",".cs",".c",".htm",".js",".xml",".php",".jsp",".rb",".pl",".asp",".ini",".cg",".java",".as",".config",".hh",".hs",".css",".scss",".sass"],k=function(){function e(t,n,i){Object(d["a"])(this,e),this.name=t,this.mimeType=i,this.path=n.replace(/\/+/g,"/"),this.thumbnail=null,this.id=null}return Object(f["a"])(e,[{key:"setType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.type=e||F(this.name,this.mimeType),this}},{key:"setFromData",value:function(e){var t=Object(h["get"])(e,"thumbnails[0].small.url");t&&(this.thumbnail=t),this.id=e.id,this.mimeType=Object(h["get"])(e,"file.mimeType");var n=Object(h["get"])(e,"parentReference.path");return n&&(this.path="/drive/root:"===n?"/":n.replace("/drive/root:","/")),this}},{key:"setState",value:function(e){return this.state=e,this}},{key:"clone",value:function(){return new e(this.name,this.path,this.mimeType)}}]),e}(),C={type:v.Name,isUp:!1};function F(e,t){var n;return n=t?-1!==t.indexOf("image/")?p.Image:-1!==t.indexOf("audio/")?p.Audio:-1!==t.indexOf("video/")?p.Video:x(e,_)?p.Code:-1!==g.indexOf(t)?p.Word:-1!==w.indexOf(t)?p.Excel:-1!==y.indexOf(t)?p.PPT:-1!==b.indexOf(t)?p.Zip:"text/plain"===t?p.Text:"application/pdf"===t?p.PDF:p.Normal:p.Folder,n}n("ac6a"),n("6b54");var O=Object.freeze({FileUploaded:Symbol("uploaded"),FileDeleted:Symbol("deleted"),SortFile:Symbol("sort"),SearchFile:Symbol("search"),OpenFile:Symbol("open"),CreateFile:Symbol("CreateFile")}),j=function(){function e(t,n,i){Object(d["a"])(this,e),this.id=Date.now().toString(32),this.user=t,this.file=n,this.z=i,this.events={}}return Object(f["a"])(e,[{key:"addEventListener",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}},{key:"clearEventListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events[e]=[]:this.events={}}}]),e}(),E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-editor-container"},[n("div",{staticClass:"text-editor"}),n("div",{staticClass:"saving",class:{show:e.saving}},[e._v("保存中")])])},U=[],S=(n("4917"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")}),I=[],T={name:"window-base-content",data:function(){return{loading:!1}},methods:{load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],!this.loading){e.next=3;break}return e.abrupt("return");case 3:if(this.$emit("update:loading",!0),this.loading=!0,!this.loadContent){e.next=8;break}return e.next=8,this.loadContent(t);case 8:this.loading=!1,this.$emit("update:loading",!1);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},D=T,z=n("2877"),P=Object(z["a"])(D,S,I,!1,null,"78bdcbee",null),W=P.exports,N=n("df7c"),R={extends:W,name:"window-editor",props:{window:j,file:k},data:function(){return{$cm:null,saving:!1}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a,s,c,l,u,d=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],n=":"+Object(N["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{force:t,user:this.window.user,path:n});case 4:return i=e.sent,r=i.data,e.next=8,this.$http.get(r["@microsoft.graph.downloadUrl"]);case 8:o=e.sent,a=o.data,this.$cm.setValue(a.toString()),s=this.file.name.match(/.+\.([^.]+)$/),console.log("editor 1",s),s&&(u=CodeMirror.findModeByExtension(s[1]),u&&(c=u.mode,l=u.mime)),console.log("editor 2",c,l),c?(this.$cm.setOption("mode",l),CodeMirror.autoLoadMode(this.$cm,c)):this.$cm.setOption("mode","text/plain");case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),deleteCache:function(){this.$store.commit("deleteCache",{user:this.window.user,path:":"+this.file.path})},save:function(){var e=this;this.loading||this.saving||(this.saving=!0,this.$http({method:"post",url:"/admin/api/upload/"+this.window.user.id,params:{path:Object(N["join"])(this.file.path,this.file.name),type:"text"},data:this.$cm.getValue()}).then(function(){e.deleteCache()}).catch(function(t){e.$notify.error("".concat(e.file.name," 保存失败：").concat(t.response.data))}).finally(function(){e.saving=!1}))}},mounted:function(){CodeMirror.modeURL="https://cdn.bootcss.com/codemirror/5.48.0/mode/%N/%N.js",this.$cm=CodeMirror(this.$el.querySelector(".text-editor"),{lineNumbers:!0,extraKeys:{"Ctrl-S":this.save,"Cmd-S":this.save}})}},L=R,M=(n("0372"),Object(z["a"])(L,E,U,!1,null,null,null)),V=M.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-viewer"},[e.loading?e._e():n("img",{attrs:{src:e.src,alt:"图片"}})])},B=[],Q={extends:W,name:"window-viewer",props:{window:j,file:k},data:function(){return{src:""}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=":"+this.file.path+"/"+this.file.name,e.next=3,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 3:return i=e.sent,r=i.data,this.src=r["@microsoft.graph.downloadUrl"],o=new Image,o.src=this.src,e.next=10,new Promise(function(e){o.addEventListener("load",function(){e()}),setTimeout(function(){e()},1e4)});case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},q=Q,J=(n("e2e6"),Object(z["a"])(q,A,B,!1,null,"965d23f6",null)),Y=J.exports,Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"})},X=[],G={extends:W,name:"window-player",props:{window:j,file:k},data:function(){return{}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("player mounted"),n=":"+Object(N["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 4:i=e.sent,r=i.data,console.log("player",n,r),new DPlayer({container:this.$el,video:{url:r["@microsoft.graph.downloadUrl"]}});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.load()}},K=G,H=(n("8610"),Object(z["a"])(K,Z,X,!1,null,"fa4addb2",null)),ee=H.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"folder-container",on:{dragenter:function(t){return t.preventDefault(),e.dragEnter(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.dropFile(t)},paste:function(t){return t.preventDefault(),e.paste(t)}}},[e.isDragEnter?n("div",{ref:"dragLeave",staticClass:"upload-icon",on:{dragleave:function(t){return t.preventDefault(),e.dragLeave(t)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"data-v-093dcf52":"","xlink:href":"#py_shangchuan1"}})]),e._m(0)]):e._e(),n("div",{staticClass:"folder"},e._l(e.files,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t,id:e.window.id},on:{dblclick:e.open}})}),1),e.nextPage?n("div",{staticClass:"next-page"},[n("el-button",{attrs:{type:"text",loading:e.loading},on:{click:e.loadNextPage}},[e._v("加载更多")])],1):e._e(),e.uploading.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[n("span",[e._v("上传中，同时上传："+e._s(e.queueConcurrency))]),n("el-button",{attrs:{type:"text"},on:{click:function(t){e.$store.state.settings=!0}}},[e._v("设置")])],1),n("div",{staticClass:"folder"},e._l(e.uploading,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),e.uploadFails.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("上传失败\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearUploadFail}},[e._v("清空")])],1),n("div",{staticClass:"folder"},e._l(e.uploadFails,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),e.waiting.length>0?n("div",{staticClass:"top-border"},[n("div",{staticClass:"header"},[e._v("等候上传\n            "),n("el-button",{attrs:{type:"text"},on:{click:e.clearWaiting}},[e._v("全部取消")])],1),n("div",{staticClass:"folder"},e._l(e.waiting,function(t,i){return n("file-view",{key:i,attrs:{parent:e.file,file:t.file,id:e.window.id}})}),1)]):e._e(),n("input",{ref:"fileInput",staticClass:"hidden-file-input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.selectUploadFiles}})])},ne=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("\n            将文件 / 文件夹 上传到这个目录"),n("br")])}],ie=(n("55dd"),n("75fc")),re=(n("28a5"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file",on:{dblclick:e.open,contextmenu:function(t){return t.preventDefault(),e.contextmenu(t)},click:e.click}},[n("div",{staticClass:"file-icon",class:{uploading:e.isUploading||e.isWaiting}},[e.image?[n("img",{attrs:{src:e.file.thumbnail,alt:"图片"}}),e.isVideo?n("svg",{staticClass:"icon video-play-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_play"}})]):e._e()]:n("file-icon",{attrs:{type:e.file.type}}),!1===e.isNormal?n("div",{staticClass:"state-icon-container"},[e.isUploading?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_shangchuan"}})]),n("div",[e._v("上传中")])]):e.isWaiting?n("div",[n("svg",{staticClass:"icon state-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_yuyue-lishi-shijian"}})]),n("div",[e._v("等待上传")])]):e._e()]):e._e()],2),n("div",{staticClass:"file-name"},[n("div",{staticClass:"file-name__ellipsis"},[e._v(e._s(e.file.name))]),n("div",{staticClass:"file-name__full"},[e._v(e._s(e.file.name))])])])}),oe=[],ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{staticClass:"icon file-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})])},se=[],ce={name:"file-icon",props:["type"],computed:{icon:function(){switch(this.type){case p.Folder:return Icons["folder"];case p.Audio:return Icons["audio"];case p.Video:return Icons["video"];case p.Image:return Icons["image"];case p.Text:return Icons["text"];case p.Zip:return Icons["zip"];case p.PDF:return Icons["pdf"];case p.Word:return Icons["word"];case p.Excel:return Icons["excel"];case p.PPT:return Icons["ppt"];case p.Code:return Icons["code"];default:return Icons["default"]}}}},le=ce,ue=Object(z["a"])(le,ae,se,!1,null,"fed657d6",null),de=ue.exports,fe={components:{FileIcon:de},props:{id:String,parent:k,file:k},data:function(){return{image:null}},computed:{isNormal:function(){return this.file.state===m.Normal},isUploading:function(){return this.file.state===m.Uploading},isWaiting:function(){return this.file.state===m.Waiting},isUploadFail:function(){return this.file.state===m.UploadFail},isVideo:function(){return this.file.type===p.Video}},methods:{open:function(){console.log("open",this.file),this.file.state===m.Normal&&this.$emit("dblclick",this.file)},contextmenu:function(e){(this.isWaiting||this.isUploading)&&this.$store.commit("appendMenuItem",{name:"取消上传",click:this.click}),this.$store.commit("contextmenu",{e:e,id:this.id,file:this.file})},click:function(){var e=this;if(!this.isNormal&&!this.isUploading)if(console.log("file click",{isWaiting:this.isWaiting,isUploadFail:this.isUploadFail}),this.isWaiting)this.$confirm("取消上传 ".concat(this.file.name," ？")).then(function(){e.$store.commit("cancelUploadFile",e.file)}).catch(function(){});else if(this.isUploadFail){var t=this.file.reason||"";this.$confirm("上传失败原因：".concat(t),"再次尝试上传 ".concat(this.file.name," ？")).then(function(){var t=e.$store.getters.getUploadingDataByFile(e.file);t&&e.$store.commit("uploadQueuePush",t)}).catch(function(){})}},loadThumbnail:function(){var e=this;if(this.image=null,this.file.state===m.Normal&&[p.Image,p.Video].indexOf(this.file.type)>-1&&this.file.thumbnail){var t=new Image;t.src=this.file.thumbnail,t.addEventListener("load",function(){e.image=e.file.thumbnail})}}},watch:{file:function(){this.loadThumbnail()}},mounted:function(){this.loadThumbnail()}},he=fe,pe=(n("64ce"),Object(z["a"])(he,re,oe,!1,null,"2b010fc5",null)),me=pe.exports,ve=n("431d"),ge=n("4230"),we=n("df7c"),ye={extends:W,name:"window-folder",components:{FileView:me},props:{window:j,file:k},data:function(){return{isDragEnter:!1,files:[],nextPage:null,sort:JSON.parse(JSON.stringify(C))}},watch:{file:function(){this.nextPage=null,this.files.length=0,this.sort=JSON.parse(JSON.stringify(C)),this.load()}},computed:{uploading:function(){return this.$store.getters.getUploading(this.window.user,this.file.path)},waiting:function(){return this.$store.getters.getUploading(this.window.user,this.file.path,m.Waiting)},uploadFails:function(){return this.$store.getters.getUploading(this.window.user,this.file.path,m.UploadFail)},queueConcurrency:{get:function(){return this.$store.getters.getUploadQueueConcurrency},set:function(e){console.log("改变队列数量",e),this.$store.commit("setUploadQueueConcurrency",e)}}},methods:{paste:function(e){console.log("粘贴事件",e);var t=e.clipboardData||e.originalEvent.clipboardData;t.items&&console.log("粘贴板有内容",t.items.length)},dragEnter:function(){this.isDragEnter||(this.isDragEnter=!0)},dragLeave:function(e){e.target===this.$refs.dragLeave&&(this.isDragEnter=!1)},click_upload:function(e){var t=this.$refs.fileInput;"folder"===e?(t.setAttribute("webkitdirectory",""),t.setAttribute("directory","")):(t.removeAttribute("webkitdirectory"),t.removeAttribute("directory")),this.$refs.fileInput.click()},selectUploadFiles:function(e){for(var t=this,n=e.target.files,i=function(e){var i=n[e],r=we.join(t.file.path,t.file.name,i.webkitRelativePath);console.log("input file",i);var o=new k(i.name,r,i.type);o.file=i;var a=Object(h["findIndex"])(t.files,{path:i.path,name:i.name});a>-1&&t.$confirm("".concat(i.name," 已经存在，是否覆盖？")).then(function(){t.$store.commit("uploadFile",{id:t.window.id,path:t.file.path,file:o})}).catch(function(){}),t.$store.commit("uploadFile",{id:t.window.id,path:t.file.path,file:o})},r=0;r<n.length;r++)i(r)},dropFile:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isDragEnter=!1,e.next=3,Object(ve["getFilesFromDataTransferItems"])(t.dataTransfer.items);case 3:n=e.sent,n.forEach(function(e){var t=e.filepath.split("/");t.pop();var n=we.join.apply(we,[i.file.path,i.file.name].concat(Object(ie["a"])(t))),r=new k(e.name,n,e.type);r.file=e;var o=Object(h["findIndex"])(i.files,{path:r.path,name:r.name});o>-1?i.$confirm("".concat(r.name," 已经存在，是否覆盖？")).then(function(){i.$store.commit("uploadFile",{id:i.window.id,path:i.file.path,file:r})}).catch(function(){}):i.$store.commit("uploadFile",{id:i.window.id,path:i.file.path,file:r})});case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),open:function(e){console.log("window-folder open",e),this.$emit("open",e)},loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a,s=this,c=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=c.length>0&&void 0!==c[0]&&c[0],n=we.join(this.file.path,this.file.name),n="/"===n?"":":".concat(n,":"),i=this.file.search,i?(t=!0,n+="/search(q='".concat(i,"')?expand=thumbnails")):n+="/children?expand=thumbnails",r="name",e.t0=this.sort.type,e.next=e.t0===v.Name?9:e.t0===v.Size?11:e.t0===v.CreatedTime?13:e.t0===v.ModifiedTime?15:16;break;case 9:return r="name",e.abrupt("break",16);case 11:return r="size",e.abrupt("break",16);case 13:return r="createdDateTime",e.abrupt("break",16);case 15:r="lastModifiedDateTime";case 16:return n+="&orderby="+r+" "+(this.sort.isUp?"desc":"asc"),t&&(this.nextPage=null),e.prev=18,e.next=21,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 21:o=e.sent,a=o.data,this.files=a.value.map(function(e){var t=we.join(s.file.path,s.file.name);return new k(e.name,t).setFromData(e).setType().setState(m.Normal)}),a["@odata.nextLink"]?this.nextPage=a["@odata.nextLink"].split("/root")[1]:this.nextPage=null,e.next=31;break;case 27:e.prev=27,e.t1=e["catch"](18),console.log("folder loadContent",e.t1),this.$emit("loadError",e.t1.response.data);case 31:case"end":return e.stop()}},e,this,[[18,27]])}));function t(){return e.apply(this,arguments)}return t}(),loadNextPage:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$store.dispatch("load",{user:this.window.user,path:this.nextPage,force:!0});case 3:n=e.sent,i=n.data,(t=this.files).push.apply(t,Object(ie["a"])(i.value.map(function(e){var t=we.join(r.file.path,r.file.name),n=new k(e.name,t);return n.setFromData(e).setType().setState(m.Normal)}))),i["@odata.nextLink"]?this.nextPage=i["@odata.nextLink"].split("/root")[1]:this.nextPage=null,this.loading=!1;case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),removeFile:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)},fileUploaded:function(e){if(e.path===we.join(this.file.path,this.file.name)){var t=Object(h["findIndex"])(this.files,{name:e.name});t>-1&&this.files.splice(t,1),this.files.push(e)}},clearWaiting:function(){var e=this;this.$confirm("确认清空等待上传的任务？").then(function(){e.$store.commit("clearUploadingFile",m.Waiting)}).catch(function(){})},clearUploadFail:function(){var e=this;this.$confirm("确认清空上传失败的任务？").then(function(){e.$store.commit("clearUploadingFile",m.UploadFail)}).catch(function(){})},create:function(e){var t=this,n=e.type,i=e.name;if(console.log("创建",n,i),n===p.Folder){var r="/"===we.join(this.file.path,this.file.name)?"/root":"/items/"+this.file.id;this.$http.get(ge["a"].createFolder+"/"+this.window.user.id+"?path="+r+"&name="+i).then(function(e){var n=e.data;t.files.push(new k(i,we.join(t.file.path,i)).setFromData(n).setType(p.Folder).setState(m.Normal))}).catch(function(){})}else this.$alert("尚未实现")},sortFile:function(e){var t=e.type,n=e.isUp;console.log("排序",t,n),this.sort.type=t,this.sort.isUp=n,this.load()}},mounted:function(){this.window.addEventListener(O.FileUploaded,this.fileUploaded),this.window.addEventListener(O.FileDeleted,this.removeFile),this.window.addEventListener(O.SortFile,this.sortFile),this.window.addEventListener(O.CreateFile,this.create)},beforeDestroy:function(){this.window.removeEventListener(O.FileUploaded,this.fileUploaded),this.window.removeEventListener(O.FileDeleted,this.removeFile),this.window.removeEventListener(O.SortFile,this.sortFile),this.window.removeEventListener(O.CreateFile,this.create)}},be=ye,xe=(n("fcf4"),Object(z["a"])(be,te,ne,!1,null,"656bc2f2",null)),_e=xe.exports,ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"loading"},[e._v("\n    读取中\n")])},Ce=[],$e={name:"window-loading"},Fe=$e,Oe=(n("01bd"),Object(z["a"])(Fe,ke,Ce,!1,null,"09339c0c",null)),je=Oe.exports,Ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("错误："+e._s(e.error))])},Ue=[],Se={name:"window-error",props:["error"]},Ie=Se,Te=Object(z["a"])(Ie,Ee,Ue,!1,null,"b8e6a73c",null),De=Te.exports,ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file-container"},[n("file-icon",{attrs:{type:e.info.type}}),n("el-form",{attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"文件名"}},[e._v(e._s(e.file.name))]),n("el-form-item",{attrs:{label:"大小"}},[e._v(e._s(e.bytesToSize(e.info.size)))]),n("el-form-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.info.createdTime))]),n("el-form-item",{attrs:{label:"修改时间"}},[e._v(e._s(e.info.modifiedTime))]),n("el-form-item",[n("a",{attrs:{href:e.info.url,target:"_blank"}},[n("el-button",{attrs:{type:"text"}},[e._v("下载")])],1)])],1)],1)},Pe=[],We=n("9944"),Ne={name:"window-binary-file",components:{FileIcon:de},extends:W,props:{window:j,file:k},data:function(){return{info:{type:null,size:0,createdTime:"",modifiedTime:"",url:""}}},methods:{loadContent:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],n=":"+Object(N["join"])(this.file.path,this.file.name),e.next=4,this.$store.dispatch("load",{user:this.window.user,path:n,force:t});case 4:i=e.sent,r=i.data,console.log("文件",r),this.$emit("loadFinish"),this.info.size=r.size,this.info.url=r["@microsoft.graph.downloadUrl"],this.info.createdTime=moment(new Date(r["createdDateTime"])).format("llll"),this.info.modifiedTime=moment(new Date(r["lastModifiedDateTime"])).format("llll"),this.info.type=F(r["name"],Object(h["get"])(r,"file.mimeType"));case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),bytesToSize:We["a"]}},Re=Ne,Le=(n("51c0"),Object(z["a"])(Re,ze,Pe,!1,null,"4849c535",null)),Me=Le.exports,Ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tool-container"},[n("div",[n("el-popover",{attrs:{placement:"bottom",width:"160"},model:{value:e.search.visible,callback:function(t){e.$set(e.search,"visible",t)},expression:"search.visible"}},[n("p",[n("el-input",{attrs:{placeholder:"输入要搜索的内容"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchFile(t)}},model:{value:e.search.word,callback:function(t){e.$set(e.search,"word",t)},expression:"search.word"}})],1),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.searchFile}},[e._v("搜索")])],1),n("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("搜索")])],1)],1),n("el-dropdown",{attrs:{size:"mini",trigger:"click"},on:{command:e.sortFile}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                排序"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.sortItems,function(t,i){return n("el-dropdown-item",{key:i,class:{current:t.type===e.sort.type},attrs:{command:t.command,icon:e.sortIcon(t.type)}},[e._v("\n                "+e._s(t.name)+"\n            ")])}),1)],1),n("el-dropdown",{attrs:{size:"mini",trigger:"click"},on:{command:e.create}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                创建"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"folder"}},[e._v("文件夹")]),n("el-dropdown-item",{attrs:{divided:""}}),n("el-dropdown-item",{attrs:{command:"text"}},[e._v("文本文件")])],1)],1),n("el-dropdown",{attrs:{type:"text",size:"mini",trigger:"hover","split-button":""},on:{click:function(t){return e.upload("file")},command:e.upload}},[e._v("\n        上传\n        "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"file"}},[e._v("文件")]),n("el-dropdown-item",{attrs:{command:"folder"}},[e._v("文件夹")])],1)],1)],1)},Ae=[],Be={name:"window-folder-tool",props:{window:j,file:k},data:function(){return{sort:JSON.parse(JSON.stringify(C)),search:{visible:!1,word:""}}},watch:{file:function(){}},methods:{upload:function(e){this.$emit("upload",e)},create:function(e){var t=this;"folder"===e?this.$prompt("输入文件夹名称","创建文件夹").then(function(e){var n=e.value;t.window.trigger(O.CreateFile,{name:n,type:p.Folder})}).catch(function(){}):"text"===e&&this.$prompt("输入文本文件名称","创建文本文件").then(function(e){var n=e.value;t.window.trigger(O.CreateFile,{name:n,type:p.Text})}).catch(function(){})},sortFile:function(e){switch(e){case"name":this.sort.type===v.Name?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.Name;break;case"size":this.sort.type===v.Size?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.Size;break;case"cTime":this.sort.type===v.CreatedTime?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.CreatedTime;break;case"mTime":this.sort.type===v.ModifiedTime?this.sort.isUp=!this.sort.isUp:this.sort.isUp=!1,this.sort.type=v.ModifiedTime;break;default:break}this.window.trigger(O.SortFile,this.sort)},searchFile:function(){this.window.trigger(O.SearchFile,this.search.word)},sortIcon:function(e){return e!==this.sort.type?"":this.sort.isUp?"el-icon-top":"el-icon-bottom"}},computed:{sortItems:function(){return[{name:"名称",command:"name",type:v.Name}]}}},Qe=Be,qe=(n("5e53"),n("309d"),Object(z["a"])(Qe,Ve,Ae,!1,null,"4933a49d",null)),Je=qe.exports,Ye={components:{WindowFolderTool:Je,WindowBinaryFile:Me,WindowError:De,WindowLoading:je,WindowFolder:_e,WindowPlayer:ee,WindowViewer:Y,WindowEditor:V},props:{window:j},data:function(){return{loading:!0,dragging:!1,zIndex:0,active:!0,history:[],historyIndex:0,error:null}},methods:{upload:function(e){!1===this.loading&&this.$refs["content"].click_upload&&this.$refs["content"].click_upload(e)},close:function(){this.$store.commit("closeWindow",this.window.id)},focus:function(){this.$store.state.activeID!==this.window.id&&this.$store.commit("windowSetTop",this.window.id)},blur:function(){},loadError:function(e){this.error=e,this.loading=!1},load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n=this,i=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]&&i[0],this.loading=!0,this.error=null,this.$nextTick(function(){n.$refs["content"].load(t)});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),open:function(e){console.log("window.vue open",this.loading,e),this.loading||(this.history.splice(this.historyIndex+1),this.append(e),this.historyIndex++,this.load())},go:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this.loading){var t=this.historyIndex+e;t>=0&&t<this.history.length&&(this.historyIndex+=e)}},append:function(e){this.history.push(e)}},computed:{current:function(){return this.history[this.historyIndex]},showFolder:function(){return this.current.type===p.Folder},showPlayer:function(){return-1!==[p.Video,p.Audio].indexOf(this.current.type)},showEditor:function(){return-1!==[p.Code,p.Text].indexOf(this.current.type)},showViewer:function(){return-1!==[p.Image].indexOf(this.current.type)},path:function(){var e=this;return this.history.slice(0,this.historyIndex+1).map(function(t,n){return 0===n?e.window.user.name:t.search?"搜索："+t.search:t.name})}},beforeMount:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.append(this.window.file),e.next=3,this.load();case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),watch:{},mounted:function(){var e=this,t=$(this.$el),n=t.find(".window--head");t.mousedown(function(){e.focus()}).draggable({handle:n,cancel:".controller",start:function(){e.focus(),e.dragging=!0},stop:function(){e.dragging=!1}}).resizable({minHeight:200,minWidth:400,start:function(){e.dragging=!0},stop:function(){e.dragging=!1}}),this.window.addEventListener(O.OpenFile,this.open),this.window.addEventListener(O.SearchFile,function(t){var n=e.current.clone();n.type=e.current.type,n.search=t,e.open(n)})}},Ze=Ye,Xe=(n("5e4f"),n("c203"),Object(z["a"])(Ze,l,u,!1,null,"b3758e30",null)),Ge=Xe.exports,Ke=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user",on:{dblclick:e.open}},[n("div",{staticClass:"user-icon"},[n("svg",{staticClass:"icon main-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#"+e.icon}})]),e.user.lock?n("svg",{staticClass:"icon lock-icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#py_lock"}})]):e._e()]),n("div",{staticClass:"user-name"},[e._v(e._s(e.user.name))])])},He=[],et=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d["a"])(this,e),this.id=t,this.name=n,this.lock=i},tt={props:{user:et},data:function(){return{icon:Icons["user"]}},methods:{open:function(){this.$store.commit("createWindow",{user:this.user,file:new k("/","/").setType(),active:!0})}}},nt=tt,it=(n("045a"),Object(z["a"])(nt,Ke,He,!1,null,"6f342a14",null)),rt=it.exports,ot=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("div",{staticClass:"contextmenu full",style:{"z-index":e.$store.state.z},on:{click:e.hide,contextmenu:function(t){return t.preventDefault(),e.hide(t)}}},[n("div",{staticClass:"contextmenu-list",style:{left:e.offsetX,top:e.offsetY}},e._l(e.list,function(t,i){return n("div",{key:i,on:{click:t.click}},[e._v(e._s(t.name))])}),0)]):e._e()},at=[],st={name:"contextmenu",props:["value","x","y","id","file"],data:function(){return{list:[]}},methods:{hide:function(){this.$emit("input",!1),this.$store.state.menuExtraItems.length=0}},computed:{offsetX:function(){return this.x+2+"px"},offsetY:function(){return this.y+2+"px"}},watch:{file:function(){var e,t=this,n=this.file,i=this.$store.state.windows[this.id],r=i.user;this.list.length=0,n.state===m.Normal&&([p.Folder,p.Text,p.Code,p.Image,p.Video,p.Audio].indexOf(this.file.type)>-1&&this.list.push({name:"新窗口打开",click:function(){t.$store.commit("createWindowFromMenu",{file:n})}}),this.file.type!==p.Folder&&this.list.push({name:"下载文件",click:function(){window.open("/download/".concat(r.id,"?path=:").concat(Object(N["join"])(n.path,n.name)))}}),this.list.push({name:"文件属性",click:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=n.clone(),t.type=p.Normal,i.trigger(O.OpenFile,t);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}),this.list.push({name:"删除文件",click:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.$confirm("确认删除文件 ".concat(n.name," ?")).then(function(){t.$http({method:"delete",url:"/admin/api/".concat(r.id,"?path=").concat(Object(N["join"])(n.path,n.name))}).then(function(){t.$notify.success("成功删除 ".concat(n.name)),i.trigger(O.FileDeleted,n)}).catch(function(e){t.$notify.error("".concat(n.name," 删除失败：").concat(e.response.data))})}).catch(function(){});case 1:case"end":return e.stop()}},e)}));function o(){return e.apply(this,arguments)}return o}()})),(e=this.list).push.apply(e,Object(ie["a"])(this.$store.state.menuExtraItems))}}},ct=st,lt=(n("3a5f"),Object(z["a"])(ct,ot,at,!1,null,"de9f41ba",null)),ut=lt.exports,dt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"settings-container",class:{show:e.show},on:{click:function(t){return t.target!==t.currentTarget?null:e.save(t)}}},[e.show?e._e():n("a",{staticClass:"settings-icon",attrs:{title:"打开设置界面"},on:{click:function(t){e.show=!e.show}}},[n("i",{staticClass:"el-icon-s-tools"})]),e.show?n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e._v("全局设置")]),n("el-form",[n("el-form-item",{attrs:{label:"同时上传文件的数量"}},[n("el-input-number",{model:{value:e.concurrency,callback:function(t){e.concurrency=t},expression:"concurrency"}})],1)],1)],1):e._e()],1)},ft=[],ht={name:"settings",data:function(){return{queueConcurrency:5}},computed:{show:{set:function(e){this.$store.state.settings=e},get:function(){return this.$store.state.settings}},concurrency:{set:function(e){e<1?e=1:e>11&&(e=10),this.queueConcurrency=e},get:function(){return this.queueConcurrency}}},methods:{save:function(){this.$store.commit("setUploadQueueConcurrency",this.queueConcurrency),this.show=!1}}},pt=ht,mt=(n("a7b8"),Object(z["a"])(pt,dt,ft,!1,null,"351761e7",null)),vt=mt.exports,gt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"empty-user"},[n("el-card",[n("div",{attrs:{slot:"header"},slot:"header"},[e._v("友情提示")]),e._v("\n        请到"),n("a",{attrs:{href:"/admin"}},[n("el-button",{attrs:{type:"text"}},[e._v("管理后台")])],1),e._v("绑定 OneDrive 账号后再使用\n    ")])],1)},wt=[],yt={name:"empty-user-tips"},bt=yt,xt=(n("bbbe"),Object(z["a"])(bt,gt,wt,!1,null,"3c0fec99",null)),_t=xt.exports,kt={components:{EmptyUserTips:_t,Settings:vt,Contextmenu:ut,UserView:rt,Window:Ge},data:function(){return{loading:!0,users:[]}},computed:{windows:function(){return this.$store.state.windows},menu:function(){return this.$store.state.menu}},methods:{},beforeMount:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,o,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.$store.commit("setVueInstance",this),e.next=4,this.$store.dispatch("api",{url:c.accounts});case 4:for(i in t=e.sent,n=t.data,this.users.length=0,n)r=n[i],o=new et(r.id,r.name),this.users.push(o);this.loading=!1,window.addEventListener("beforeunload",function(e){if(a.$store.state.uploadingLength>0){var t="\\o/";return(e||window.event).returnValue=t,t}});case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},Ct=kt,$t=(n("bb28"),Object(z["a"])(Ct,r,o,!1,null,"1e5bbbc0",null)),Ft=$t.exports,Ot=n("2f62"),jt=n("17d4"),Et=n.n(jt),Ut=n("bc3a");i["default"].use(Ot["a"]);var St,It=Et()(function(e,t){var n=e.user,i=e.file;i.state=e.state=m.Uploading;var r=new FormData,o=Object(N["join"])(ge["a"].uploadFile,n.id)+"?type=file&path="+Object(N["join"])(i.path,i.name);r.append("file",i.file),Ut({method:"post",url:o,data:r,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){var n=e.data;console.log("SUCCESS!!"),i.setFromData(n),i.setType(),St.$notify.success({title:"上传成功",message:i.name}),t&&t(!0)}).catch(function(e){var n=e.response;console.log("FAILURE!!",n),i.reason=n.data,St.$notify.error({title:"上传失败："+i.name,message:i.reason}),t&&t(!1)})},5),Tt=new Ot["a"].Store({state:{z:1,windows:{},menu:{show:!1,x:0,y:0,id:null,file:null},menuExtraItems:[],activeID:null,error:null,cache:{},uploading:[],uploadingLength:0,uploadQueueConcurrency:It.concurrency,settings:!1},getters:{getUploading:function(e){return function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Uploading;return e.uploading.filter(function(e){return e.user===t&&e.path===n&&e.state===i})}},getUploadingDataByFile:function(e){return function(t){var n=Object(h["findIndex"])(e.uploading,["file",t]);return n>-1?e.uploading[n]:null}},getUploadQueueConcurrency:function(e){return e.uploadQueueConcurrency}},mutations:{setVueInstance:function(e,t){St=t},setUploadQueueConcurrency:function(e,t){e.uploadQueueConcurrency=t,It.concurrency=t,console.log("改变后",It.concurrency)},setError:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"错误";e.error={title:n,content:t.data}},setCache:function(e,t){var n=t.url,i=t.res;e.cache[n]=i},createWindow:function(e,t){var n=t.user,r=t.file,o=t.active,a=void 0!==o&&o;console.log("createWindow");var s=new j(n,r,e.z);i["default"].set(e.windows,s.id,s),e.z++,a&&(e.activeID=s.id)},createWindowFromMenu:function(e,t){var n=t.file;this.commit("createWindow",{user:e.windows[e.menu.id].user,file:n,active:!0})},contextmenu:function(e,t){var n=t.e,i=t.id,r=t.file;console.log("右键",n,i,r),e.menu.show=!0,e.menu.x=n.clientX,e.menu.y=n.clientY,e.menu.file=r,e.menu.id=i},appendMenuItem:function(e,t){var n=t.name,i=t.click;e.menuExtraItems.push({name:n,click:i})},clearWindow:function(e){e.windows={}},closeWindow:function(e,t){e.windows[t].clearEventListener(),i["default"].delete(e.windows,t)},windowSetTop:function(e,t){e.activeID=t,e.windows[t].z=e.z;var n=Object(h["sortBy"])(e.windows,"z");n.forEach(function(e){var t=n.indexOf(e);e.z=t+1}),e.z=n.length+1},uploadFile:function(e,t){var n=t.id,i=t.path,r=t.file,o=e.windows[n].user,a={id:n,user:o,path:i,file:r,state:m.Waiting};this.commit("uploadQueuePush",a)},cancelUploadFile:function(e,t){var n=Object(h["findIndex"])(e.uploading,["file",t]);n>-1&&(e.uploading.splice(n,1),It.remove(function(e){var n=e.data;return n.file===t}))},uploadQueuePush:function(e,t){var n=t.id,i=t.file,r=e.uploading.indexOf(t);r>-1&&e.uploading.splice(r,1),e.uploading.push(t),i.state=t.state=m.Waiting,It.push(t,function(r){console.log("上传结果",i.path,r);var o=e.uploading.indexOf(t);o>-1&&e.uploading.splice(o,1),r?(i.state=m.Normal,e.windows[n].trigger(O.FileUploaded,i)):(i.state=t.state=m.UploadFail,e.uploading.push(t))})},clearUploadingFile:function(e,t){e.uploading=e.uploading.filter(function(e){var n=e.file;return n.state!==t}),It.kill()},deleteCache:function(e,t){var n=t.user,i=t.path,r=c.loadFile+"/"+n.id+"?path="+i;delete e.cache[r]}},actions:{api:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ut(n);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),t.commit("setError",e.t0.response),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,6]])}));function t(t,n){return e.apply(this,arguments)}return t}(),load:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){var i,r,o,a,s,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=n.user,r=n.path,o=n.force,a=void 0!==o&&o,s=c.loadFile+"/"+i.id+"?path="+encodeURIComponent(r),console.log("load",s,a),!t.state.cache[s]||a){e.next=5;break}return e.abrupt("return",t.state.cache[s]);case 5:return e.next=7,Ut.get(s);case 7:return l=e.sent,200===l.status&&!1===a&&t.commit("setCache",{url:s,res:l}),e.abrupt("return",l);case 10:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()}}),Dt=Tt,zt=(n("e008"),n("5c96")),Pt=n.n(zt);n("0fae");i["default"].config.productionTip=!1,i["default"].use(Pt.a),i["default"].prototype.$http=n("bc3a"),new i["default"]({store:Dt,render:function(e){return e(Ft)}}).$mount("#app")},e008:function(e,t,n){},e2e6:function(e,t,n){"use strict";var i=n("9b68"),r=n.n(i);r.a},e784:function(e,t,n){},fcf4:function(e,t,n){"use strict";var i=n("9337"),r=n.n(i);r.a}});