[tox]
envlist = py27, py36, py37, lint

[testenv]
deps =
  -r{toxinidir}/requirements.txt
  -r{toxinidir}/etc/dev-requirements.txt

passenv =
  SQLALCHEMY_DATABASE_URI

whitelist_externals =
  mkdir

commands =
  devel: - pip uninstall -qy abilian-core
  devel: pip install -q git+https://github.com/abilian/abilian-core.git@master

  pip check

  # ensure instance dir exists
  mkdir -p -v {toxinidir}/instance

  pytest -p no:sugar


[testenv:py27-sqlite]
setenv =
  SQLALCHEMY_DATABASE_URI = sqlite://

[testenv:py27-postgres]
setenv =
  SQLALCHEMY_DATABASE_URI = postgres://localhost/abilian_crm_test


[testenv:lint]
basepython = python3.6

deps =
  {[testenv]deps}
  flake8-bugbear
  flake8-mypy

commands =
  flake8 abilian
  # fix errors first
  # mypy abilian
