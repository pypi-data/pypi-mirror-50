

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CherryPicker &mdash; CherryPicker 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-143748897-1"></script>
        <script type="text/javascript" src="_static/google_analytics_tracker.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Filtering" href="filter.html" />

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
	"palette": {
		"popup": {
			"background": "#eaf7f7",
			"text": "#5c7291"
		},
		"button": {
			"background": "#56cbdb",
			"text": "#ffffff"
		}
	},
	"theme": "edgeless",
    "position": "bottom-right"
})});
</script>


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> CherryPicker
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filter.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="extract.html">Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">CherryPicker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>CherryPicker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cherrypicker">
<h1>CherryPicker<a class="headerlink" href="#cherrypicker" title="Permalink to this headline">¶</a></h1>
<p><em>Flatten complex data.</em></p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code> aims to make common ETL tasks (filtering data and
restructuring it into flat tables) easier, by taking inspiration from jQuery
and applying it in a Pythonic way to generic data objects.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install cherrypicker
</pre></div>
</div>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code> provides a chainable filter and extraction interface to
allow you to easily pick out objects from complex structures and place them in
a flat table. It fills a similar role to jQuery in JavaScript, enabling you to
navigate complex structures without the need for lots of complex nested for
loops or list comprehensions.</p>
<p>Behold…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cherrypicker</span> <span class="kn">import</span> <span class="n">CherryPicker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;climate.json&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span> <span class="o">=</span> <span class="n">CherryPicker</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[[1, &#39;Amsterdam&#39;], [2, &#39;Athens&#39;], [3, &#39;Atlanta GA&#39;], ...]</span>
</pre></div>
</div>
<p>This example is equivalent to the list comprehension
<code class="code python docutils literal notranslate"><span class="punctuation"><span class="pre">[[</span></span><span class="name"><span class="pre">item</span></span><span class="punctuation"><span class="pre">[</span></span><span class="literal string single"><span class="pre">‘id’</span></span><span class="punctuation"><span class="pre">],</span></span> <span class="name"><span class="pre">item</span></span><span class="punctuation"><span class="pre">[</span></span><span class="literal string single"><span class="pre">‘city’</span></span><span class="punctuation"><span class="pre">]]</span></span> <span class="keyword"><span class="pre">for</span></span> <span class="name"><span class="pre">item</span></span> <span class="operator word"><span class="pre">in</span></span> <span class="name"><span class="pre">data</span></span><span class="punctuation"><span class="pre">]</span></span></code>. <code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code>
really starts to become useful when you combine it with filtering:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s1">&#39;B*&#39;</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[[6, &#39;Bangkok&#39;], [7, &#39;Barcelona&#39;], [8, &#39;Beijing&#39;], ...]</span>
</pre></div>
</div>
<p>The equivalent list comprehension would be:
<code class="code python docutils literal notranslate"><span class="punctuation"><span class="pre">[[</span></span><span class="name"><span class="pre">item</span></span><span class="punctuation"><span class="pre">[</span></span><span class="literal string single"><span class="pre">‘id’</span></span><span class="punctuation"><span class="pre">],</span></span> <span class="name"><span class="pre">item</span></span><span class="punctuation"><span class="pre">[</span></span><span class="literal string single"><span class="pre">‘city’</span></span><span class="punctuation"><span class="pre">]]</span></span> <span class="keyword"><span class="pre">for</span></span> <span class="name"><span class="pre">item</span></span> <span class="operator word"><span class="pre">in</span></span> <span class="name"><span class="pre">data</span></span> <span class="keyword"><span class="pre">if</span></span> <span class="name"><span class="pre">item</span></span><span class="punctuation"><span class="pre">[</span></span><span class="literal string single"><span class="pre">‘city’</span></span><span class="punctuation"><span class="pre">]</span></span><span class="operator"><span class="pre">.</span></span><span class="name"><span class="pre">startswith</span></span><span class="punctuation"><span class="pre">(</span></span><span class="literal string single"><span class="pre">‘B’</span></span><span class="punctuation"><span class="pre">)]</span></span></code>.
As you can see, <code class="xref py py-class docutils literal notranslate"><span class="pre">CherryPicker</span></code> does filtering and extraction with
chained operations rather than list comprehensions. <a class="reference internal" href="filter.html"><span class="doc">Filtering</span></a>
is done with parentheses <code class="docutils literal notranslate"><span class="pre">()</span></code> and <a class="reference internal" href="extract.html"><span class="doc">extraction</span></a> is done with
square brackets <code class="docutils literal notranslate"><span class="pre">[]</span></code>. Chaining can make it easier to build complex
operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s1">&#39;B*&#39;</span><span class="p">)[</span><span class="s1">&#39;info&#39;</span><span class="p">](</span>
<span class="gp">... </span>    <span class="n">population</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2000000</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span>
<span class="gp">... </span><span class="p">)[</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[[1568, 8300000], [891, 3700000], [203, 2800000]]</span>
</pre></div>
</div>
<p>This is getting too unwieldy for list comprehensions already; to achieve the
example above in another way we may wish to use a for loop:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000000</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Without <code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code>, the amount of code we need to write increases
pretty rapidly! There are many different types of filtering predicate you can
use with <code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code>, including exact matches, wildcards, regex and
custom functions. Read all about them in the <a class="reference internal" href="filter.html"><span class="doc">Filtering</span></a> documentation.</p>
<p>Of course, it would be nice if we could extract data in the example above from
both the base level and the <code class="docutils literal notranslate"><span class="pre">info</span></code> sub-level of each item and put them into a
flat table, ready to load into your favourite data analysis package. We can do
this in <code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code> with <a class="reference internal" href="api.html#cherrypicker.CherryPickerMapping.flatten" title="cherrypicker.CherryPickerMapping.flatten"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cherrypicker.CherryPickerMapping.flatten()</span></code></a>.
Let’s say that each item in our data list has a city name and a list of average
low/high temperatures for each month of the year:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Amsterdam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Netherlands&quot;</span><span class="p">,</span>
        <span class="s2">&quot;monthlyAvg&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;dryDays&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
                <span class="s2">&quot;snowDays&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s2">&quot;rainfall&quot;</span><span class="p">:</span> <span class="mi">68</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;dryDays&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
                <span class="s2">&quot;snowDays&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;rainfall&quot;</span><span class="p">:</span> <span class="mi">47</span>
            <span class="p">},</span>
            <span class="o">...</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>By flattening the data before filtering/extracting, we can get the name and
monthly temperatures alongside each other:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">monthlyAvg_0_high</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tmp</span><span class="p">:</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)[</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;monthlyAvg_0_high&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[[&#39;Bangkok&#39;, 33], [&#39;Brasilia&#39;, 31], [&#39;Ho Chi Minh City&#39;, 33], ...]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">monthlyAvg_0_high</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tmp</span><span class="p">:</span> <span class="n">tmp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;monthlyAvg_0_high&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[[&#39;Calgary&#39;, -1], [&#39;Montreal&#39;, -4], [&#39;Moscow&#39;, -4], ...]</span>
</pre></div>
</div>
<p>One final point to note is that <code class="xref py py-mod docutils literal notranslate"><span class="pre">cherrypicker</span></code> understands data by looking
at its <em>interfaces</em> rather than its <em>types</em>. This means that it isn’t just
limited to JSON data: as long as it can act like a dict or list, you can start
cherrypicking from it!</p>
<div class="section" id="parallel-processing">
<h2>Parallel Processing<a class="headerlink" href="#parallel-processing" title="Permalink to this headline">¶</a></h2>
<p>As well as making complex queries easier, <code class="xref py py-class docutils literal notranslate"><span class="pre">CherryPicker</span></code> also allows you
to easily use parallel processing to crunch through large datasets quickly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span> <span class="o">=</span> <span class="n">CherryPicker</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s1">&#39;B*&#39;</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>Everything is the same as before, except you supply an <cite>n_jobs</cite> parameter to
specify the number of CPUs you wish to use (a value of <cite>-1</cite> will mean all CPUs
are used).</p>
<p>Note that for small datasets, you will probably get better performance without
parallel processing, as the benefits of using multiple CPUs will be outweighed
by the overhead of setting up multiple processes. For large datasets with long
lists though, parallel processing can significantly speed up your operations.</p>
<ul class="simple">
<li><a class="reference internal" href="filter.html"><span class="doc">Filtering</span></a></li>
<li><a class="reference internal" href="extract.html"><span class="doc">Extraction</span></a></li>
<li><a class="reference internal" href="api.html"><span class="doc">API Reference</span></a></li>
</ul>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="indices-and-tables">
<h3>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="filter.html" class="btn btn-neutral float-right" title="Filtering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, big-o

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-143748897-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>