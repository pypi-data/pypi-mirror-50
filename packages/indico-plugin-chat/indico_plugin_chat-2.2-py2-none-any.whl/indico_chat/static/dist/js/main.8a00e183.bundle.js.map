{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../plugins/public/chat/indico_chat/client/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","global","$t","$T","domain","eventManageChat","$","on","e","preventDefault","toggler","this","closest","next","find","slideToggle","start","toggleClass","$this","msg","gettext","data","confirmPrompt","then","form","action","method","csrf","type","attr","append","appendTo","submit","ajax","url","dataType","complete","IndicoUI","Dialogs","Util","progress","success","handleAjaxError","result","AlertPopup","open","window","location","href","eventManageChatLogs","container","iframe","materialWidget","killProgress","logParams","ajaxForm","beforeSubmit","hide","error","doc","contentWindow","document","write","html","close","params","prop","show","materialName","val","trim","extend","material_name","blur","rangeWidget","daterange","allowPast","fieldNames","startDate","endDate","pickerOptions","yearRange"],"mappings":"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","file":"js/main.8a00e183.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/plugins/chat/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// This file is part of the Indico plugins.\n// Copyright (C) 2002 - 2019 CERN\n//\n// The Indico plugins are free software; you can redistribute\n// them and/or modify them under the terms of the MIT License;\n// see the LICENSE file for more details.\n\nimport './main.scss';\n\n(function(global) {\n  const $t = $T.domain('chat');\n\n  global.eventManageChat = function eventManageChat() {\n    $('.toggle-details').on('click', function(e) {\n      e.preventDefault();\n      const toggler = $(this);\n      toggler\n        .closest('tr')\n        .next('tr')\n        .find('.details-container')\n        .slideToggle({\n          start() {\n            toggler.toggleClass('icon-next icon-expand');\n          },\n        });\n    });\n\n    $('.js-chat-remove-room').on('click', function(e) {\n      e.preventDefault();\n      const $this = $(this);\n      let msg = $t.gettext('Do you really want to remove this chatroom from the event?');\n      if ($this.data('numEvents') == 1) {\n        msg += '<br>';\n        if ($this.data('customServer')) {\n          msg += $t.gettext(\n            'Since it is on an external server, it will not be deleted on that server.'\n          );\n        } else {\n          msg += $t.gettext(\n            'Since it is only used in this event, it will be deleted from the Jabber server, too!'\n          );\n        }\n      }\n      confirmPrompt(msg, $t.gettext('Delete this chatroom?')).then(function() {\n        const form = $('<form>', {\n          action: $this.data('href'),\n          method: 'post',\n        });\n        const csrf = $('<input>', {\n          type: 'hidden',\n          name: 'csrf_token',\n          value: $('#csrf-token').attr('content'),\n        });\n        form\n          .append(csrf)\n          .appendTo('body')\n          .submit();\n      });\n    });\n\n    $('.js-chat-refresh-room').on('click', function(e) {\n      e.preventDefault();\n      $.ajax({\n        url: $(this).data('href'),\n        type: 'POST',\n        dataType: 'json',\n        complete: IndicoUI.Dialogs.Util.progress(),\n        success(data) {\n          if (handleAjaxError(data)) {\n            return;\n          }\n          if (data.result == 'not-found') {\n            new AlertPopup(\n              $t.gettext('Chatroom not found'),\n              $t.gettext(\n                'The chatroom does not exist on the Jabber server anymore. We recommend you to delete it chatroom from Indico as well.'\n              )\n            ).open();\n          } else if (data.result == 'changed') {\n            new AlertPopup(\n              $t.gettext('Chatroom updated'),\n              $t.gettext('The chatroom data has been updated.'),\n              function() {\n                window.location.href = window.location.href;\n              }\n            ).open();\n          }\n        },\n      });\n    });\n  };\n\n  global.eventManageChatLogs = function eventManageChatLogs() {\n    const container = $('#chat-log-display-container');\n    const iframe = $('#chat-log-display');\n    const materialWidget = $('#chat-log-material');\n    let killProgress, logParams;\n\n    $('#chat-log-form').ajaxForm({\n      dataType: 'json',\n      beforeSubmit() {\n        container.hide();\n        materialWidget.hide();\n        killProgress = IndicoUI.Dialogs.Util.progress();\n      },\n      error: handleAjaxError,\n      success(data) {\n        if (handleAjaxError(data)) {\n          return;\n        } else if (!data.success) {\n          new AlertPopup($t.gettext('No logs available'), data.msg).open();\n          return;\n        }\n        const doc = iframe[0].contentWindow.document;\n        doc.write(data.html);\n        doc.close();\n        logParams = data.params;\n        $('#chat-log-material')\n          .find('input, button')\n          .prop('disabled', false);\n        container.show();\n        materialWidget.show();\n      },\n      complete() {\n        killProgress();\n      },\n    });\n\n    $('#chat-create-material').on('click', function(e) {\n      e.preventDefault();\n      const $this = $(this);\n      const materialName = $('#chat-material-name')\n        .val()\n        .trim();\n      if (!materialName) {\n        return;\n      }\n      const params = $.extend({}, logParams, {\n        material_name: materialName,\n      });\n      $.ajax({\n        url: $this.data('href'),\n        type: 'POST',\n        data: params,\n        dataType: 'json',\n        error: handleAjaxError,\n        complete: IndicoUI.Dialogs.Util.progress(),\n        success(data) {\n          if (handleAjaxError(data)) {\n            return;\n          } else if (!data.success) {\n            new AlertPopup($t.gettext('Could not create material'), data.msg).open();\n            return;\n          }\n          $('#chat-log-material')\n            .find('input, button')\n            .prop('disabled', true)\n            .blur();\n          new AlertPopup(\n            $t.gettext('Material created'),\n            $t.gettext('The chat logs have been attached to the event.')\n          ).open();\n        },\n      });\n    });\n\n    const rangeWidget = $('#chat-log-range');\n    rangeWidget.daterange({\n      allowPast: true,\n      fieldNames: ['start_date', 'end_date'],\n      startDate: rangeWidget.data('startDate'),\n      endDate: rangeWidget.data('endDate'),\n      pickerOptions: {\n        yearRange: 'c-1:c+1',\n      },\n    });\n  };\n})(window);\n"],"sourceRoot":""}