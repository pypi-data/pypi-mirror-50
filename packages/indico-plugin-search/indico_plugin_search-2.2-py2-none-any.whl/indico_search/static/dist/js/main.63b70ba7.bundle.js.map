{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../plugins/public/search/indico_search/client/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","global","$t","$T","domain","type","_highlight","elem","token","idx","toLowerCase","indexOf","before","slice","after","length","Html","span","_truncateTitle","title","concat","max","_showSuggestions","text","suggList","totalNumber","self","this","suggestionBox","WatchValue","suggestionList","ul","infoBox","div","gettext","style","position","top","pixels","left","className","$B","number","container","append","tokens","_","filter","escapeHTML","split","tokenRE","RegExp","join","counter","titleHtml","replace","index","dom","innerHTML","pathText","Util","truncateCategPath","path","liItem","li","observeEvent","selectorPos","_clearSelector","_setSelector","observeClick","window","location","url","set","_hideSuggestions","remove","suggestions","_retrieveOptions","expression","querying","$","ajax","searchUrl","data","term","dataType","complete","timeOfLastQuery","Date","getTime","success","handleAjaxError","results","count","currentText","trim","_textTyped","_getTimeSinceLastQuery","_waitForRequestTime","queuedRequest","setTimeout","_openSelection","event","_moveSelector","direction","suggNum","item","isAnyItemSelected","args","autocomplete","RealtimeTextBox","observe","observeOtherKeys","$E","document","body","ancestorOf","eventTarget","input","widget","options","categ_title","everywhere","search_category_url","search_url","form","_transition","no_check","$tag","old_width","width","fadeTo","find","html","new_width","animate","_create","tag_template","template","element","replaceWith","$where","addClass","hide","show","on","search_everywhere","$parent","parent","show_categ","e","show_tip","removeData","confirm_tip","back_to_everywhere","qtip","fadeOut","fadeIn","removeClass","attr","content","format","at","my","ready","categorySearchBox","extra","controls","extraConfigured","verifyForm","startDate","val","endDate","parseDateTime","IndicoDateTimeFormats","DefaultHourless","is","slideUp","slideDown","css","of","intelligentSearchBox","IntelligentSearchBox","id","backgroundColor","outline","categoryNamesUrl","datepicker","draw","submit","which","isRoot","search_tag","categoryName","searchCategoryUrl"],"mappings":"aACA,IAAAA,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QAKAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,+BAIAlC,IAAAmC,EAAA,kCClFAnC,EAAAkB,EAAAkB,GAAApC,EAAA,IASA,SAAUqC,GACR,MAAMC,EAAKC,GAAGC,OAAO,UAErBC,KACE,uBACA,CAAC,mBACD,CACEC,WAAWC,EAAMC,GAEf,MAAMC,EAAMF,EAAKG,cAAcC,QAAQH,EAAME,eAC7C,GAAID,GAAO,EAAG,CACZ,MAAMG,EAASL,EAAKM,MAAM,EAAGJ,GACvBK,EAAQP,EAAKM,MAAMJ,EAAMD,EAAMO,OAAQR,EAAKQ,QAClD,MAAO,CAACH,EAAQI,KAAKC,KAAK,YAAaV,EAAKM,MAAMJ,EAAKA,EAAMD,EAAMO,SAAUD,KAIjFI,eAAeC,GAETA,EAAMJ,OADE,GAEV,GAAAK,OAAUD,EAAMN,MAAM,EAAGQ,MAAzB,SAAAD,OAAyCD,EAAMN,OAAM,OAE9CM,EAIXG,iBAAiBC,EAAMC,EAAUC,GAC/B,MAAMC,EAAOC,KACb,IAAKA,KAAKC,cAAe,CAIvBD,KAAKF,YAAc,IAAII,WAAWJ,GAClCE,KAAKG,eAAiBd,KAAKe,KAE3B,MAAMC,EAAUhB,KAAKiB,IAAI,OAAQ/B,EAAGgC,QAAQ,iCAG5CP,KAAKC,cAAgBZ,KAAKiB,IACxB,CACEE,MAAO,CACLC,SAAU,WACVC,IAAKC,OAAO,IACZC,KAAM,GAERC,UAAW,kBAEbR,EACAL,KAAKG,eACLW,GAAGzB,KAAKiB,IAAI,iBAAkBN,KAAKF,YAAa,SAASiB,GACvD,OAAkB,IAAXA,EACH,GADG,GAAAtB,OAEAsB,EAFA,KAAAtB,OAEUlB,EAAGgC,QAAQ,4CAIhCP,KAAKgB,UAAUC,OAAOjB,KAAKC,eAI7B,MAAMiB,EAASC,EAAEC,OAAOC,WAAWzB,GAAM0B,MAAM,KAAM,SAAS/D,GAC5D,MAAa,KAANA,IAEHgE,EAAU,IAAIC,OAAJ,IAAA/B,OAAeyB,EAAOO,KAAK,KAA3B,KAAoC,MAGpD,IAAIC,EAAU,EAEdZ,GAAGd,KAAKG,eAAgBN,EAAU,SAASjB,GACzC,MAAM+C,EAAYN,WAAWtB,EAAKR,eAAeX,EAAKY,QAAQoC,QAC5DL,EACA,qCAEIM,EAAQH,EACRlC,EAAQH,KAAKC,KAAK,SACxBE,EAAMsC,IAAIC,UAAYJ,EACtB,MAAMK,EAAWC,KAAKC,kBAAkBtD,EAAKuD,MAAMV,KAAK,QAClDU,EAAO9C,KAAKiB,IAAI,OAAQ0B,GACxBI,EAAS/C,KAAKgD,GAAG,GAAI7C,EAAO2C,GAiBlC,OAbAC,EAAOE,aAAa,YAAa,WAC3BvC,EAAKwC,aAAeV,IACtB9B,EAAKyC,iBACLzC,EAAKwC,YAAcV,EACnB9B,EAAK0C,kBAITL,EAAOM,aAAa,WAClBC,OAAOC,SAAWhE,EAAKiE,MAGzBnB,IACOU,IAGTpC,KAAKG,eAAemC,aAAa,WAAY,WAC3CvC,EAAKyC,iBACLzC,EAAKwC,aAAe,IAItBvC,KAAKF,YAAYgD,IAAIhD,IAGvBiD,mBACE/C,KAAKgB,UAAUgC,OAAOhD,KAAKC,eAC3BD,KAAKC,cAAgB,KACrBD,KAAKuC,aAAe,EACpBvC,KAAKiD,YAAc,MAGrBC,iBAAiBC,GACf,MAAMpD,EAAOC,KACbA,KAAKoD,UAAW,EAEhBC,EAAEC,KAAK,CACLT,IAAK9C,EAAKwD,UACV7E,KAAM,MACN8E,KAAM,CACJC,KAAMN,GAERO,SAAU,OACVC,WACE5D,EAAKqD,UAAW,EAChBrD,EAAK6D,iBAAkB,IAAIC,MAAOC,WAEpCC,QAAQP,GACN,GAAIQ,gBAAgBR,GAClB,OAGEA,EAAKS,QAAQ7E,QACfW,EAAKkD,YAAcO,EAAKS,QACxBlE,EAAKJ,iBAAiBwD,EAAYK,EAAKS,QAAST,EAAKU,MAAQV,EAAKS,QAAQ7E,SAE1EW,EAAKgD,mBAGP,MAAMoB,EAAcC,KAAKrE,EAAK7C,OAI1BiH,GAAehB,GAAcgB,EAAY/E,OAAS,EAEpDW,EAAKsE,aACIF,EAAY/E,QAAU,GAE/BW,EAAKgD,uBAMbuB,yBAEE,OADY,IAAIT,MACLC,UAAY9D,KAAK4D,iBAG9BW,sBACE,MAAMxE,EAAOC,KACRA,KAAKwE,gBAKNxE,KAAKsE,yBAA2B,KAClCtE,KAAKqE,aACLrE,KAAKwE,eAAgB,GAErBC,WAAW,WACT1E,EAAKwE,uBACJ,OAQPF,WAAWzG,GACT,MAAMmC,EAAOC,KACPJ,EAAOwE,KAAKpE,KAAK9C,OAEnB0C,EAAKR,OAAS,GAGXY,KAAKoD,UAAYpD,KAAKsE,yBAA2B,IACpDtE,KAAKkD,iBAAiBtD,GACZI,KAAKwE,gBAGfxE,KAAKwE,eAAgB,EAErBC,WAAW,WACT1E,EAAKwE,uBACJ,MAEIvE,KAAKC,eACdD,KAAK+C,oBAIT2B,eAAeC,GACb,QAAI3E,KAAKuC,aAAe,KACtBI,OAAOC,SAAW5C,KAAKiD,YAAYjD,KAAKuC,aAAaM,KAC9C,IAQX+B,cAAcC,GACZ,GAAI7E,KAAKC,cAAe,CACtB,MAAM6E,EAAU9E,KAAKG,eAAef,OAAOlC,MAEvC8C,KAAKuC,YAAc,EACrBvC,KAAKuC,YAA2B,QAAbsC,EAAsB,EAAIC,EAAU,GAEvD9E,KAAKwC,iBACLxC,KAAKuC,aAA4B,MAAbsC,GAAqB,EAAI,EAEzC7E,KAAKuC,aAAeuC,EACtB9E,KAAKuC,aAAe,EACXvC,KAAKuC,YAAc,IAC5BvC,KAAKuC,aAAe,IAK1BvC,KAAKyC,gBAGPA,eACMzC,KAAKuC,aAAe,IACtBvC,KAAKG,eAAe4E,KAAK/E,KAAKuC,aAAaT,IAAIjB,UAAY,aAI/D2B,iBACMxC,KAAKuC,aAAe,IACtBvC,KAAKG,eAAe4E,KAAK/E,KAAKuC,aAAaT,IAAIjB,UAAY,KAI/DmE,oBACE,OAAOhF,KAAKuC,YAAc,IAG9B,SAAS0C,EAAMjE,EAAWuC,GACxB0B,EAAKC,aAAe,MACpBlF,KAAKmF,gBAAgBF,GACrBjF,KAAKuC,aAAe,EACpBvC,KAAKoD,UAAW,EAChBpD,KAAKgB,UAAYA,EACjBhB,KAAK4D,gBAAkB,EACvB5D,KAAKuD,UAAYA,EAEjB,MAAMxD,EAAOC,KAEbA,KAAKoF,QAAQ,SAASxH,EAAK+G,GAEzB,OADA5E,EAAKsE,WAAWzG,IACT,IAGToC,KAAKqF,iBAAiB,SAASzF,EAAMhC,EAAK+G,GACxC,OAAW,IAAP/G,GAAoB,IAAPA,GACfmC,EAAK6E,cAAqB,IAAPhH,EAAY,KAAO,SAC/B,GACS,IAAPA,GACTmC,EAAKgD,oBACE,GACS,IAAPnF,GACFmC,EAAK2E,eAAeC,KAM/BW,GAAGC,SAASC,MAAM9C,aAAa,SAASiC,GAUpC5E,EAAKE,gBACJF,EAAKI,eAAesF,WAAWH,GAAGI,YAAYf,MAC/CW,GAAGI,YAAYf,KAAW5E,EAAK4F,OAE/B5F,EAAKgD,uBAMbM,EAAEuC,OAAO,oBAAqB,CAC5BC,QAAS,CACPC,YAAa,OACbC,YAAY,EACZC,oBAAqB,IACrBC,WAAY,IACZC,KAAM,MAGRC,YAAY3G,EAAO4G,GACjB,MAAMC,EAAOrG,KAAKqG,KACZC,EAAYD,EAAKE,QAEvBF,EACGG,OAAO,OAAQ,IACfD,MAAM,IACNE,KAAK,UACLC,KAAKlH,GACR,MAAMmH,EAAYN,EAAKE,QAGvBF,EACGG,OAAO,OAAQ,IACfD,MAAMD,GACN9C,KAAK,eAAgBmD,GAExBN,EAAKO,QACH,CACEL,MAAOI,EAAYL,IAAcF,EAAWE,EAAYK,GAE1D,IACA,WAIJE,UACE,MAAM9G,EAAOC,KAEP8G,EAAe3F,EAAE4F,SACrB,uGAMIV,EAAQrG,KAAKqG,KAAOhD,EACxByD,EAAa,CACXhB,YAAa9F,KAAK6F,QAAQE,WACtBxH,EAAGgC,QAAQ,cACXP,KAAK6F,QAAQC,eAIrBzC,EAAErD,KAAKgH,SAASC,YAAYZ,GAC5B,MAAMa,EAAS7D,EAAE,SAAUgD,GAEvBrG,KAAK6F,QAAQE,YACfM,EAAKc,SAAS,cACd9D,EAAE,SAAUrD,KAAKqG,MAAMe,SAEvBf,EAAKc,SAAS,eACd9D,EAAE,SAAUrD,KAAKqG,MAAMgB,QAGzBhE,EAAE,SAAUgD,GAAMiB,GAAG,QAAS,WAC5BvH,EAAKwH,sBAGP,MAAMC,EAAUnB,EAAKoB,SAErBD,EAAQF,GAAG,aAAc,yBAA0B,WACjDvH,EAAK2H,eAEPF,EAAQF,GAAG,YAAa,yBAA0B,SAASK,GACzD5H,EAAK6H,SAASD,KAEhBH,EAAQF,GAAG,aAAc,yBAA0B,WACjDJ,EAAOW,WAAW,cAEpBL,EAAQF,GAAG,QAAS,+BAAgC,WAClDvH,EAAK+H,gBAEPN,EAAQF,GAAG,aAAc,+BAAgC,WACvDvH,EAAKgI,wBAITD,cACE,MAAMZ,EAAS7D,EAAE,SAAUrD,KAAKqG,MAC1BA,EAAOrG,KAAKqG,KAElBA,EAAK2B,KAAK,WACVd,EAAOe,QAAQ,OAAQ,WACrB5E,EAAErD,MAAMkI,OAAO,UAGjBlI,KAAKqG,KACFc,SAAS,eACTgB,YAAY,cACZA,YAAY,oBACfnI,KAAK6F,QAAQK,KAAKkC,KAAK,SAAUpI,KAAK6F,QAAQG,qBAG9CK,EAAKO,QACH,CACEL,MAAOF,EAAK7C,KAAK,gBAAkBH,EAAE,SAAUgD,GAAME,QAAU,IAEjE,IACA,QACA,WACElD,EAAE,SAAUgD,GAAM6B,OAAO,WAK/BX,oBACElE,EAAE,SAAUrD,KAAKqG,MAAMe,OACvBpH,KAAKqG,KAAKc,SAAS,cAAcgB,YAAY,eAC7CnI,KAAKmG,YAAY5H,EAAGgC,QAAQ,eAAe,GAC3CP,KAAK6F,QAAQK,KAAKkC,KAAK,SAAUpI,KAAK6F,QAAQI,aAGhDyB,aACE,MAAMrB,EAAOrG,KAAKqG,KACZa,EAAS7D,EAAE,SAAUgD,GACrBtG,EAAOC,KACbkH,EAAO1D,KAAK,YAAY,GACxBiB,WAAW,WACLyC,EAAO1D,KAAK,cACdzD,EAAKoG,YAAYpG,EAAK8F,QAAQC,aAC9BO,EAAKc,SAAS,sBAEf,MAGLS,SAASjD,GACP3E,KAAKqG,KAAK2B,KACR,CACEK,QAASC,OAAO/J,EAAGgC,QAAQ,6DAA8D,CACvFf,MAAOQ,KAAK6F,QAAQC,cAEtBrF,SAAU,CACR8H,GAAI,gBACJC,GAAI,cAENnB,KAAM,CACJ1C,MAAOA,EAAMjG,KACb+J,OAAO,IAGX9D,IAIJoD,qBACE,MAAMb,EAAS7D,EAAE,SAAUrD,KAAKqG,MAC1BtG,EAAOC,KAEbA,KAAKqG,KAAK8B,YAAY,oBACtBjB,EAAOW,WAAW,YAClBpD,WAAW,WACJyC,EAAO1D,KAAK,cACfzD,EAAKoG,YAAY5H,EAAGgC,QAAQ,eAAe,GAC3CR,EAAKsG,KAAKc,SAAS,gBAEpB,QAIP7I,EAAOoK,kBAAoB,SAA2B7C,GAEpD,MAAMK,EAAO7C,EAAE,yBACTsF,EAAQzC,EAAKO,KAAK,kBAClBmC,EAAW1C,EAAKO,KAAK,oBAC3B,IAAIoC,GAAkB,EAiBtB,SAASC,IACP,MAAMC,EAAY1F,EAAE,sBAAsB2F,MACpCC,EAAU5F,EAAE,oBAAoB2F,MACtC,QACID,GAAa9G,KAAKiH,cAAcH,EAAWI,sBAAsBC,qBACjEH,GAAWhH,KAAKiH,cAAcD,EAASE,sBAAsBC,kBArBnE/F,EAAE,2BAA2BiE,GAAG,QAAS,WACnCqB,EAAMU,GAAG,YACXV,EAAMW,QAAQ,SAEdX,EAAMY,UAAU,QACXV,IACHA,GAAkB,EAClBF,EAAMa,IAAI,UAAW,SAAS/I,SAAS,CACrCgJ,GAAIb,EACJJ,GAAI,YACJD,GAAI,qBAeZ,MAAMmB,EAAuB,IAAIC,qBAC/B,CACE/M,KAAM,gBACNgN,GAAI,gBACJpJ,MAAO,CAACqJ,gBAAiB,cAAeC,QAAS,SAEnDxE,GAAG,uBACHO,EAAQkE,kBAGV1G,EAAE,wCAAwC2G,aAC1C1E,GAAG,iBAAiB2B,YAAYyC,EAAqBO,QAErD5G,EAAE,kBAAkBiE,GAAG,QAAS,WAC1BwB,KACFzF,EAAE,yBAAyB6G,WAI/B7G,EAAE,kBAAkBiE,GAAG,WAAY,SAASK,GAC3B,IAAXA,EAAEwC,OAAgBT,EAAqB1E,qBACrC8D,KACFzF,EAAE,yBAAyB6G,WAK5BrE,EAAQuE,SACX/G,EAAE,wCAAwCpE,OAAOoE,EAAE,6BACnDA,EAAE,eAAegH,WAAW,CAC1BtE,YAAY,EACZD,YAAaD,EAAQyE,aACrBpE,KAAM7C,EAAE,yBACR4C,WAAYJ,EAAQtC,UACpByC,oBAAqBH,EAAQ0E,sBAzhBrC,CA6hBG5H","file":"js/main.63b70ba7.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/plugins/search/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// This file is part of the Indico plugins.\n// Copyright (C) 2002 - 2019 CERN\n//\n// The Indico plugins are free software; you can redistribute\n// them and/or modify them under the terms of the MIT License;\n// see the LICENSE file for more details.\n\nimport './main.scss';\n\n(function(global) {\n  const $t = $T.domain('search');\n\n  type(\n    'IntelligentSearchBox',\n    ['RealtimeTextBox'],\n    {\n      _highlight(elem, token) {\n        // Code for highlighting the matched part of the string\n        const idx = elem.toLowerCase().indexOf(token.toLowerCase());\n        if (idx >= 0) {\n          const before = elem.slice(0, idx);\n          const after = elem.slice(idx + token.length, elem.length);\n          return [before, Html.span('highlight', elem.slice(idx, idx + token.length)), after];\n        }\n      },\n\n      _truncateTitle(title) {\n        const max = 27;\n        if (title.length > max) {\n          return `${title.slice(0, max / 2)} ... ${title.slice(-max / 2)}`;\n        } else {\n          return title;\n        }\n      },\n\n      _showSuggestions(text, suggList, totalNumber) {\n        const self = this;\n        if (!this.suggestionBox) {\n          // Create the suggestion box only once\n\n          // totalNumber will change during time\n          this.totalNumber = new WatchValue(totalNumber);\n          this.suggestionList = Html.ul();\n\n          const infoBox = Html.div('help', $t.gettext('Some category suggestions...'));\n\n          // Create the suggestion box\n          this.suggestionBox = Html.div(\n            {\n              style: {\n                position: 'absolute',\n                top: pixels(23),\n                left: 0,\n              },\n              className: 'suggestion-box',\n            },\n            infoBox,\n            this.suggestionList,\n            $B(Html.div('other-results'), this.totalNumber, function(number) {\n              return number === 0\n                ? ''\n                : `${number} ${$t.gettext('other results - please write more...')}`;\n            })\n          );\n\n          this.container.append(this.suggestionBox);\n        }\n\n        // Prepare regular expression for highlighting\n        const tokens = _.filter(escapeHTML(text).split(' '), function(t) {\n          return t !== '';\n        });\n        const tokenRE = new RegExp(`(${tokens.join('|')})`, 'gi');\n\n        // Bind the list to the DOM element\n        let counter = 0;\n\n        $B(this.suggestionList, suggList, function(elem) {\n          const titleHtml = escapeHTML(self._truncateTitle(elem.title)).replace(\n            tokenRE,\n            '<span class=\"highlight\">$1</span>'\n          );\n          const index = counter;\n          const title = Html.span('title');\n          title.dom.innerHTML = titleHtml;\n          const pathText = Util.truncateCategPath(elem.path).join(' >> ');\n          const path = Html.div('path', pathText);\n          const liItem = Html.li({}, title, path);\n\n          // Use mouse to control selector as well\n\n          liItem.observeEvent('mouseover', function() {\n            if (self.selectorPos != index) {\n              self._clearSelector();\n              self.selectorPos = index;\n              self._setSelector();\n            }\n          });\n\n          liItem.observeClick(function() {\n            window.location = elem.url;\n          });\n\n          counter++;\n          return liItem;\n        });\n\n        this.suggestionList.observeEvent('mouseout', function() {\n          self._clearSelector();\n          self.selectorPos = -1;\n        });\n\n        // Update\n        this.totalNumber.set(totalNumber);\n      },\n\n      _hideSuggestions() {\n        this.container.remove(this.suggestionBox);\n        this.suggestionBox = null;\n        this.selectorPos = -1;\n        this.suggestions = null;\n      },\n\n      _retrieveOptions(expression) {\n        const self = this;\n        this.querying = true;\n\n        $.ajax({\n          url: self.searchUrl,\n          type: 'GET',\n          data: {\n            term: expression,\n          },\n          dataType: 'json',\n          complete() {\n            self.querying = false;\n            self.timeOfLastQuery = new Date().getTime();\n          },\n          success(data) {\n            if (handleAjaxError(data)) {\n              return;\n            }\n\n            if (data.results.length) {\n              self.suggestions = data.results;\n              self._showSuggestions(expression, data.results, data.count - data.results.length);\n            } else {\n              self._hideSuggestions();\n            }\n\n            const currentText = trim(self.get());\n\n            // if the text changed meanwhile and it\n            // is still long enough\n            if (currentText != expression && currentText.length > 1) {\n              // request\n              self._textTyped();\n            } else if (currentText.length <= 1) {\n              // if it is not long enough\n              self._hideSuggestions();\n            }\n          },\n        });\n      },\n\n      _getTimeSinceLastQuery() {\n        const now = new Date();\n        return now.getTime() - this.timeOfLastQuery;\n      },\n\n      _waitForRequestTime() {\n        const self = this;\n        if (!this.queuedRequest) {\n          // This should never happen...\n          return;\n        }\n\n        if (this._getTimeSinceLastQuery() > 1000) {\n          this._textTyped();\n          this.queuedRequest = false;\n        } else {\n          setTimeout(function() {\n            self._waitForRequestTime();\n          }, 300);\n        }\n      },\n\n      /*\n       * Called each time a new character is typed\n       * strips white spaces, and calls for a request if needed\n       */\n      _textTyped(key) {\n        const self = this;\n        const text = trim(this.get());\n\n        if (text.length > 1) {\n          // if we're not already querying and enough time has passed\n          // since the last request\n          if (!this.querying && this._getTimeSinceLastQuery() > 1000) {\n            this._retrieveOptions(text);\n          } else if (!this.queuedRequest) {\n            // otherwise, if we can't do a request right now\n            // and no other request is queued\n            this.queuedRequest = true;\n\n            setTimeout(function() {\n              self._waitForRequestTime();\n            }, 300);\n          }\n        } else if (this.suggestionBox) {\n          this._hideSuggestions();\n        }\n      },\n\n      _openSelection(event) {\n        if (this.selectorPos >= 0) {\n          window.location = this.suggestions[this.selectorPos].url;\n          return false;\n        }\n        return true;\n      },\n\n      /*\n       * Move the selector (gray area) up or down\n       */\n      _moveSelector(direction) {\n        if (this.suggestionBox) {\n          const suggNum = this.suggestionList.length.get();\n\n          if (this.selectorPos < 0) {\n            this.selectorPos = direction == 'down' ? 0 : suggNum - 1;\n          } else {\n            this._clearSelector();\n            this.selectorPos += direction == 'up' ? -1 : 1;\n\n            if (this.selectorPos >= suggNum) {\n              this.selectorPos = -1;\n            } else if (this.selectorPos < 0) {\n              this.selectorPos = -1;\n            }\n          }\n        }\n\n        this._setSelector();\n      },\n\n      _setSelector() {\n        if (this.selectorPos >= 0) {\n          this.suggestionList.item(this.selectorPos).dom.className = 'selected';\n        }\n      },\n\n      _clearSelector() {\n        if (this.selectorPos >= 0) {\n          this.suggestionList.item(this.selectorPos).dom.className = '';\n        }\n      },\n\n      isAnyItemSelected() {\n        return this.selectorPos > 0;\n      },\n    },\n    function(args, container, searchUrl) {\n      args.autocomplete = 'off';\n      this.RealtimeTextBox(args);\n      this.selectorPos = -1;\n      this.querying = false;\n      this.container = container;\n      this.timeOfLastQuery = 0;\n      this.searchUrl = searchUrl;\n\n      const self = this;\n\n      this.observe(function(key, event) {\n        self._textTyped(key);\n        return true;\n      });\n\n      this.observeOtherKeys(function(text, key, event) {\n        if (key == 38 || key == 40) {\n          self._moveSelector(key == 38 ? 'up' : 'down');\n          return false;\n        } else if (key == 27) {\n          self._hideSuggestions();\n          return false;\n        } else if (key == 13) {\n          return self._openSelection(event);\n        } else {\n          return true;\n        }\n      });\n\n      $E(document.body).observeClick(function(event) {\n        // Close box if a click is done outside of it\n\n        /* for some unknown reason, onclick is called on the submit button,\n         * as soon as the return key is pressed in any of the textfields.\n         * To make it even better, onclick is called before onkeyup,\n         * which forces us to do the last two checks.\n         */\n\n        if (\n          self.suggestionBox &&\n          !self.suggestionList.ancestorOf($E(eventTarget(event))) &&\n          $E(eventTarget(event)) != self.input\n        ) {\n          self._hideSuggestions();\n        }\n      });\n    }\n  );\n\n  $.widget('indico.search_tag', {\n    options: {\n      categ_title: 'Home',\n      everywhere: true,\n      search_category_url: '#',\n      search_url: '#',\n      form: null,\n    },\n\n    _transition(title, no_check) {\n      const $tag = this.$tag;\n      const old_width = $tag.width();\n\n      $tag\n        .fadeTo('fast', 0.3)\n        .width('')\n        .find('.where')\n        .html(title);\n      const new_width = $tag.width();\n\n      // store target width\n      $tag\n        .fadeTo('fast', 0.5)\n        .width(old_width)\n        .data('target-width', new_width);\n\n      $tag.animate(\n        {\n          width: new_width < old_width && !no_check ? old_width : new_width,\n        },\n        200,\n        'linear'\n      );\n    },\n\n    _create() {\n      const self = this;\n\n      const tag_template = _.template(\n        '<div class=\"search-tag\">' +\n          '<div class=\"cross\">x</div>' +\n          '<div class=\"where\"><%= categ_title %></div>' +\n          '</div>'\n      );\n\n      const $tag = (this.$tag = $(\n        tag_template({\n          categ_title: this.options.everywhere\n            ? $t.gettext('Everywhere')\n            : this.options.categ_title,\n        })\n      ));\n\n      $(this.element).replaceWith($tag);\n      const $where = $('.where', $tag);\n\n      if (this.options.everywhere) {\n        $tag.addClass('everywhere');\n        $('.cross', this.$tag).hide();\n      } else {\n        $tag.addClass('in-category');\n        $('.cross', this.$tag).show();\n      }\n\n      $('.cross', $tag).on('click', function() {\n        self.search_everywhere();\n      });\n\n      const $parent = $tag.parent();\n\n      $parent.on('mouseenter', '.search-tag.everywhere', function() {\n        self.show_categ();\n      });\n      $parent.on('mouseover', '.search-tag.everywhere', function(e) {\n        self.show_tip(e);\n      });\n      $parent.on('mouseleave', '.search-tag.everywhere', function() {\n        $where.removeData('hasFocus');\n      });\n      $parent.on('click', '.search-tag.in-category-over', function() {\n        self.confirm_tip();\n      });\n      $parent.on('mouseleave', '.search-tag.in-category-over', function() {\n        self.back_to_everywhere();\n      });\n    },\n\n    confirm_tip() {\n      const $where = $('.where', this.$tag);\n      const $tag = this.$tag;\n\n      $tag.qtip('destroy');\n      $where.fadeOut('fast', function() {\n        $(this).fadeIn('fast');\n      });\n\n      this.$tag\n        .addClass('in-category')\n        .removeClass('everywhere')\n        .removeClass('in-category-over');\n      this.options.form.attr('action', this.options.search_category_url);\n\n      // use target-width as search-tag may still be growing\n      $tag.animate(\n        {\n          width: $tag.data('target-width') + $('.cross', $tag).width() + 10,\n        },\n        200,\n        'swing',\n        function() {\n          $('.cross', $tag).fadeIn('fast');\n        }\n      );\n    },\n\n    search_everywhere() {\n      $('.cross', this.$tag).hide();\n      this.$tag.addClass('everywhere').removeClass('in-category');\n      this._transition($t.gettext('Everywhere'), true);\n      this.options.form.attr('action', this.options.search_url);\n    },\n\n    show_categ() {\n      const $tag = this.$tag;\n      const $where = $('.where', $tag);\n      const self = this;\n      $where.data('hasFocus', true);\n      setTimeout(function() {\n        if ($where.data('hasFocus')) {\n          self._transition(self.options.categ_title);\n          $tag.addClass('in-category-over');\n        }\n      }, 200);\n    },\n\n    show_tip(event) {\n      this.$tag.qtip(\n        {\n          content: format($t.gettext('Click to search inside <span class=\"label\">{title}</span>'), {\n            title: this.options.categ_title,\n          }),\n          position: {\n            at: 'bottom center',\n            my: 'top center',\n          },\n          show: {\n            event: event.type,\n            ready: true,\n          },\n        },\n        event\n      );\n    },\n\n    back_to_everywhere() {\n      const $where = $('.where', this.$tag);\n      const self = this;\n\n      this.$tag.removeClass('in-category-over');\n      $where.removeData('hasFocus');\n      setTimeout(function() {\n        if (!$where.data('hasFocus')) {\n          self._transition($t.gettext('Everywhere'), true);\n          self.$tag.addClass('everywhere');\n        }\n      }, 200);\n    },\n  });\n\n  global.categorySearchBox = function categorySearchBox(options) {\n    // expected options: categoryNamesUrl, searchUrl, searchCategoryUrl, categoryName, isRoot\n    const form = $('#category-search-form');\n    const extra = form.find('.extra-options');\n    const controls = form.find('.search-controls');\n    let extraConfigured = false;\n    $('#category-search-expand').on('click', function() {\n      if (extra.is(':visible')) {\n        extra.slideUp('fast');\n      } else {\n        extra.slideDown('fast');\n        if (!extraConfigured) {\n          extraConfigured = true;\n          extra.css('display', 'table').position({\n            of: controls,\n            my: 'right top',\n            at: 'right bottom',\n          });\n        }\n      }\n    });\n\n    function verifyForm() {\n      const startDate = $('#search-start_date').val();\n      const endDate = $('#search-end_date').val();\n      return (\n        (!startDate || Util.parseDateTime(startDate, IndicoDateTimeFormats.DefaultHourless)) &&\n        (!endDate || Util.parseDateTime(endDate, IndicoDateTimeFormats.DefaultHourless))\n      );\n    }\n\n    const intelligentSearchBox = new IntelligentSearchBox(\n      {\n        name: 'search-phrase',\n        id: 'search-phrase',\n        style: {backgroundColor: 'transparent', outline: 'none'},\n      },\n      $E('category-search-box'),\n      options.categoryNamesUrl\n    );\n\n    $('#search-start_date, #search-end_date').datepicker();\n    $E('search-phrase').replaceWith(intelligentSearchBox.draw());\n\n    $('.search-button').on('click', function() {\n      if (verifyForm()) {\n        $('#category-search-form').submit();\n      }\n    });\n\n    $('#search-phrase').on('keypress', function(e) {\n      if (e.which == 13 && !intelligentSearchBox.isAnyItemSelected()) {\n        if (verifyForm()) {\n          $('#category-search-form').submit();\n        }\n      }\n    });\n\n    if (!options.isRoot) {\n      $('#category-search-form .search-button').before($('<div class=\"search-tag\">'));\n      $('.search-tag').search_tag({\n        everywhere: true,\n        categ_title: options.categoryName,\n        form: $('#category-search-form'),\n        search_url: options.searchUrl,\n        search_category_url: options.searchCategoryUrl,\n      });\n    }\n  };\n})(window);\n"],"sourceRoot":""}