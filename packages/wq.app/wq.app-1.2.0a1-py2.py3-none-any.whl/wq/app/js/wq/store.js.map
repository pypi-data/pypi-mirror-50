{"version":3,"file":"store.js","sources":["../../node_modules/redux-persist/es/stateReconciler/autoMergeLevel2.js","../../node_modules/@wq/store/src/store.js"],"sourcesContent":["var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexport default function autoMergeLevel2(inboundState, originalState, reducedState, _ref) {\n  var debug = _ref.debug;\n\n  var newState = _extends({}, reducedState);\n  // only rehydrate if inboundState exists and is an object\n  if (inboundState && (typeof inboundState === 'undefined' ? 'undefined' : _typeof(inboundState)) === 'object') {\n    Object.keys(inboundState).forEach(function (key) {\n      // ignore _persist data\n      if (key === '_persist') return;\n      // if reducer modifies substate, skip auto rehydration\n      if (originalState[key] !== reducedState[key]) {\n        if (process.env.NODE_ENV !== 'production' && debug) console.log('redux-persist/stateReconciler: sub state for key `%s` modified, skipping.', key);\n        return;\n      }\n      if (isPlainEnoughObject(reducedState[key])) {\n        // if object is plain enough shallow merge the new values (hence \"Level2\")\n        newState[key] = _extends({}, newState[key], inboundState[key]);\n        return;\n      }\n      // otherwise hard set\n      newState[key] = inboundState[key];\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production' && debug && inboundState && (typeof inboundState === 'undefined' ? 'undefined' : _typeof(inboundState)) === 'object') console.log('redux-persist/stateReconciler: rehydrated keys \\'' + Object.keys(inboundState).join(', ') + '\\'');\n\n  return newState;\n}\n\n/*\n  autoMergeLevel2: \n    - merges 2 level of substate\n    - skips substate if already modified\n    - this is essentially redux-perist v4 behavior\n*/\n\nfunction isPlainEnoughObject(o) {\n  return o !== null && !Array.isArray(o) && (typeof o === 'undefined' ? 'undefined' : _typeof(o)) === 'object';\n}","import {\n    createStore,\n    combineReducers,\n    applyMiddleware,\n    compose,\n    bindActionCreators\n} from 'redux';\nimport logger from 'redux-logger';\nimport { persistStore, persistReducer, createTransform } from 'redux-persist';\nimport autoMergeLevel2 from 'redux-persist/lib/stateReconciler/autoMergeLevel2';\n\nimport localForage from 'localforage';\nimport 'whatwg-fetch';\n\nconst REMOVE = '@@KVP_REMOVE';\nconst SET = '@@KVP_SET';\nconst CLEAR = '@@KVP_CLEAR';\n\n// Internal variables and functions\nvar _verbosity = {\n    Network: 1,\n    Lookup: 2,\n    Values: 3\n};\n\nclass Store {\n    name;\n    debug = false;\n    // Base URL of web service\n    service;\n    // Default parameters (e.g f=json)\n    defaults = {};\n\n    ready = {\n        then: function() {\n            throw new Error('Call init first!');\n        }\n    };\n\n    // Registered redux functions\n    #reducers = {};\n    #enhanceReducers = [];\n    #persistKeys = [];\n    #transforms = [];\n    #middleware = [];\n    #enhancers = [];\n    #subscribers = [];\n    #deferActions = [];\n    #thunkHandler = null;\n\n    #_promises = {}; // Save promises to prevent redundant fetches\n\n    constructor(name) {\n        if (_stores[name]) {\n            throw name + ' store already exists!';\n        }\n        this.name = name;\n        _stores[name] = this;\n        this.addReducer(\n            'kvp',\n            (state, action) => this.kvpReducer(state, action),\n            true\n        );\n    }\n\n    init(opts = {}) {\n        var self = this;\n        var optlist = [\n            'debug',\n            'storageFail',\n\n            'service',\n            'defaults',\n            'fetchFail',\n            'ajax',\n            'formatKeyword'\n        ];\n        optlist.forEach(function(opt) {\n            if (opts.hasOwnProperty(opt)) {\n                self[opt] = opts[opt];\n            }\n        });\n        if (self.debug) {\n            for (var level in _verbosity) {\n                if (self.debug >= _verbosity[level]) {\n                    self['debug' + level] = true;\n                }\n            }\n            self.addMiddleware(logger);\n        }\n\n        var storeReady;\n        self.ready = new Promise(resolve => (storeReady = resolve));\n\n        var reducer = combineReducers(this.#reducers);\n        this.#enhanceReducers.forEach(enhanceReducer => {\n            reducer = enhanceReducer(reducer);\n        });\n        const enhancers = compose(\n            ...this.#enhancers,\n            applyMiddleware(...this.#middleware)\n        );\n\n        this.lf = localForage.createInstance({ name: this.name });\n\n        const persistConfig = {\n            key: 'root',\n            storage: this.lf,\n            stateReconciler: autoMergeLevel2,\n            serialize: false,\n            transforms: this.#transforms,\n            whitelist: this.#persistKeys,\n            writeFailHandler: error => this.storageFail(error)\n        };\n        const persistedReducer = persistReducer(persistConfig, reducer);\n        this._store = createStore(persistedReducer, {}, enhancers);\n        this._persistor = persistStore(this._store);\n        this._persistor.subscribe(() => {\n            const { bootstrapped } = this._persistor.getState();\n            if (bootstrapped) {\n                storeReady();\n            }\n        });\n        this.#subscribers.forEach(fn => this._store.subscribe(fn));\n        this.#deferActions.forEach(this._store.dispatch);\n    }\n\n    dispatch(action) {\n        if (this._store) {\n            return this._store.dispatch(action);\n        } else {\n            this.#deferActions.push(action);\n        }\n    }\n\n    subscribe(fn) {\n        this.#subscribers.push(fn);\n        if (this._store) {\n            this._store.subscribe(fn);\n        }\n    }\n\n    getState() {\n        return this._store.getState();\n    }\n\n    addReducer(name, reducer, persist, deserialize) {\n        this.#reducers[name] = reducer;\n        if (persist) {\n            this.persistKey(name, persist, deserialize);\n        }\n    }\n\n    addEnhanceReducer(name, enhanceReducer, persist, deserialize) {\n        this.#enhanceReducers.push(enhanceReducer);\n        if (persist) {\n            this.persistKey(name, persist, deserialize);\n        }\n    }\n\n    persistKey(name, serialize, deserialize) {\n        this.#persistKeys.push(name);\n        if (serialize && deserialize) {\n            this.#transforms.push(\n                createTransform(serialize, deserialize, { whitelist: [name] })\n            );\n        }\n    }\n\n    addMiddleware(middleware) {\n        this.#middleware.push(middleware);\n    }\n\n    addEnhancer(enhancer) {\n        this.#enhancers.push(enhancer);\n    }\n\n    bindActionCreators(actions) {\n        return bindActionCreators(actions, this.dispatch.bind(this));\n    }\n\n    addThunk(name, thunk) {\n        if (!this.#thunkHandler) {\n            throw new Error('@wq/router is required to handle thunks');\n        }\n        this.#thunkHandler(name, thunk);\n    }\n\n    setThunkHandler(handler) {\n        this.#thunkHandler = handler;\n    }\n\n    kvpReducer(state = {}, action) {\n        if (action.type === REMOVE) {\n            state = { ...state };\n            delete state[action.payload.key];\n        } else if (action.type === SET) {\n            state = {\n                ...state,\n                [action.payload.key]: action.payload.value\n            };\n        } else if (action.type === CLEAR) {\n            state = {};\n        }\n        return state;\n    }\n\n    // Get value from datastore\n    async get(query) {\n        await this.ready;\n        var self = this;\n        if (Array.isArray(query)) {\n            var promises = query.map(row => self.get(row));\n            return Promise.all(promises);\n        }\n        query = self.normalizeQuery(query);\n        var key = self.toKey(query);\n\n        if (self.debugLookup) {\n            console.log('looking up ' + key);\n        }\n\n        // Check storage first\n        const kvp = this.getState().kvp;\n        if (kvp[key]) {\n            if (self.debugLookup) {\n                console.log('in storage');\n            }\n            return kvp[key];\n        } else {\n            // Search ends here if query is a simple string\n            if (typeof query == 'string') {\n                if (self.debugLookup) {\n                    console.log('not found');\n                }\n                return null;\n            }\n\n            // More complex queries are assumed to be server requests\n            return self.fetch(query, true);\n        }\n    }\n\n    // Set value\n    async set(query, value) {\n        var self = this;\n        var key = self.toKey(query);\n        if (value === null) {\n            if (self.debugLookup) {\n                console.log('deleting ' + key);\n            }\n            self.dispatch({\n                type: REMOVE,\n                payload: { key }\n            });\n            return;\n        } else {\n            if (self.debugLookup) {\n                console.log('saving new value for ' + key);\n                if (self.debugValues) {\n                    console.log(value);\n                }\n            }\n            self.dispatch({\n                type: SET,\n                payload: { key, value }\n            });\n            return;\n        }\n    }\n\n    // Callback for localStorage failure - override to inform the user\n    storageFail(error) {\n        console.warn('Error persisting store:');\n        console.warn(error);\n    }\n\n    // Convert \"/url\" to {'url': \"url\"} (simplify common use case)\n    normalizeQuery(query) {\n        if (typeof query === 'string' && query.charAt(0) == '/') {\n            query = { url: query.replace(/^\\//, '') };\n        }\n        return query;\n    }\n\n    // Helper to allow simple objects to be used as keys\n    toKey(query) {\n        var self = this;\n        query = self.normalizeQuery(query);\n        if (!query) {\n            throw 'Invalid query!';\n        }\n        if (typeof query == 'string') {\n            return query;\n        } else {\n            return new URLSearchParams(query).toString();\n        }\n    }\n\n    // Helper to check existence of a key without loading the object\n    exists(query) {\n        var self = this;\n        var key = self.toKey(query);\n        return self.keys().then(function(keys) {\n            var found = false;\n            keys.forEach(function(k) {\n                if (k === key) {\n                    found = true;\n                }\n            });\n            return found;\n        });\n    }\n\n    // Fetch data from server\n    fetch(query, cache) {\n        var self = this;\n        query = self.normalizeQuery(query);\n        var key = self.toKey(query);\n        var data = { ...self.defaults, ...query };\n        var url = self.service;\n        if (data.hasOwnProperty('url')) {\n            url = url + '/' + data.url;\n            delete data.url;\n        }\n        if (data.format && !self.formatKeyword) {\n            url += '.' + data.format;\n            delete data.format;\n        }\n\n        if (this.#_promises[key]) {\n            return this.#_promises[key];\n        }\n\n        if (self.debugNetwork) {\n            console.log('fetching ' + key);\n        }\n\n        var promise = self.ajax(url, data, 'GET');\n        this.#_promises[key] = promise.then(\n            async data => {\n                delete this.#_promises[key];\n                if (!data) {\n                    self.fetchFail(query, 'Error parsing data!');\n                    return;\n                }\n                if (self.debugNetwork) {\n                    console.log('received result for ' + key);\n                    if (self.debugValues) {\n                        console.log(data);\n                    }\n                }\n                if (cache) {\n                    await self.set(query, data);\n                }\n                return data;\n            },\n            error => {\n                delete this.#_promises[key];\n                console.error(error);\n                self.fetchFail(query, 'Error parsing data!');\n            }\n        );\n        return this.#_promises[key];\n    }\n\n    // Hook to allow full AJAX customization\n    ajax(url, data, method, headers) {\n        var urlObj = new URL(url, window.location.origin);\n        if (!method) {\n            method = 'GET';\n        } else {\n            method = method.toUpperCase();\n        }\n        if (method == 'GET') {\n            Object.entries(data || {}).forEach(([key, value]) =>\n                urlObj.searchParams.append(key, value)\n            );\n            data = null;\n        }\n        return fetch(urlObj, {\n            method: method,\n            body: data,\n            headers: headers\n        }).then(response => {\n            if (response.ok) {\n                if (response.status === 204) {\n                    return null;\n                } else {\n                    return response.json();\n                }\n            } else {\n                return response.text().then(result => {\n                    var error = new Error();\n                    try {\n                        error.json = JSON.parse(result);\n                    } catch (e) {\n                        error.text = result;\n                    }\n                    error.status = response.status;\n                    throw error;\n                });\n            }\n        });\n    }\n\n    // Callback for fetch() failures - override to inform the user\n    fetchFail(query, error) {\n        var self = this;\n        var key = self.toKey(query);\n        console.warn('Error loading ' + key + ': ' + error);\n    }\n\n    // Helper function for prefetching data\n    prefetch(query) {\n        var self = this;\n        return self.fetch(query, true);\n    }\n\n    // Clear local caches\n    async reset() {\n        this.dispatch({ type: CLEAR });\n        await this._persistor.purge();\n    }\n\n    // List storage keys matching this store's key prefix\n    async keys() {\n        return Object.keys(this.getState().kvp);\n    }\n}\n\nvar _stores = {};\n\n// Hybrid module object provides/is a singleton instance...\nvar ds = new Store('main');\n\n// ... and a way to retrieve/autoinit other stores\nds.getStore = getStore;\nfunction getStore(name) {\n    if (_stores[name]) {\n        return _stores[name];\n    } else {\n        return new Store(name);\n    }\n}\n\nexport default ds;\nexport { getStore, Store };\n"],"names":["_typeof","Symbol","_typeof2","iterator","obj","constructor","prototype","_extends","Object","assign","target","i","arguments","length","source","key","hasOwnProperty","call","autoMergeLevel2","inboundState","originalState","reducedState","_ref","debug","newState","keys","forEach","isPlainEnoughObject","o","Array","isArray","REMOVE","SET","CLEAR","_verbosity","Network","Lookup","Values","Store","name","then","Error","_stores","addReducer","state","action","kvpReducer","opts","self","optlist","opt","level","addMiddleware","logger","storeReady","ready","Promise","resolve","reducer","combineReducers","enhanceReducer","enhancers","compose","applyMiddleware","lf","localForage","createInstance","persistConfig","storage","stateReconciler","serialize","transforms","whitelist","writeFailHandler","error","storageFail","persistedReducer","persistReducer","_store","createStore","_persistor","persistStore","subscribe","getState","bootstrapped","fn","dispatch","push","persist","deserialize","persistKey","createTransform","middleware","enhancer","actions","bindActionCreators","bind","thunk","handler","type","payload","value","query","promises","map","row","get","all","normalizeQuery","toKey","debugLookup","console","log","kvp","fetch","debugValues","warn","charAt","url","replace","URLSearchParams","toString","found","k","cache","data","defaults","service","format","formatKeyword","debugNetwork","promise","ajax","fetchFail","set","method","headers","urlObj","URL","window","location","origin","toUpperCase","entries","searchParams","append","body","response","ok","status","json","text","result","JSON","parse","e","purge","ds","getStore"],"mappings":"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"}