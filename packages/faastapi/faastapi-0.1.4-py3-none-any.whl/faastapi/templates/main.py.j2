"""
This template can be used to generate a Python file defining a FastAPI server
"""
from typing import *
from fastapi import Body
from faastapi import QuickFastAPI, Context, get_context
from models import Output, OpenFaasConfig
from handler import handle


openfaas_config = OpenFaasConfig()


if openfaas_config.enable_openfaas:
    openapi_prefix = "/function/demo-faastapi"
else:
    openapi_prefix = ""
app = QuickFastAPI(openapi_prefix=openapi_prefix)


app.configure()


@app.post("/", dependencies=[app.get_user], response_model=Output)
async def post(
    message: str = Body(default="Hello world!", embed=True),
    context: Context = get_context
):
    _resp = handle(context, message)
    return _resp


@app.get("/", dependencies=[app.get_user], response_model=Output)
async def get(
    message: str = "Hello !",
    context: Context = get_context
):
    _resp = handle(context, message)
    return _resp

